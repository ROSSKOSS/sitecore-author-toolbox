const multipliers={GB:1073741824,MB:1048576,KB:1024,bytes:1},toBytes=e=>{const t=e.split(" "),n=t[0].replace(",",""),a=t[1];return n*multipliers[a]},getData=()=>Array.from(document.querySelectorAll("#Table1 table tr")).slice(1).map(e=>({name:e.children[1].innerText,count:e.children[2].innerText,size:e.children[3].innerText,delta:e.children[4].innerText,maxSize:e.children[5].innerText})).map(e=>{const t=toBytes(e.size),n=toBytes(e.maxSize);var a=0===n?0:t/n*100;return isNaN(a)&&(a=0),{...e,useRate:Number(a.toFixed(2)),under80:a<80}}),getTotals=()=>{const e=document.getElementById("c_totals").innerText,t=e.match(/(?<=Entries: )[^,]+/)[0],n=e.match(/(?<=Size: ).+/)[0];return{entries:parseInt(t),size:parseInt(n)}},form=document.getElementsByTagName("form")[0];if(document.getElementsByName("c_refresh")[0]){const e=document.getElementsByName("c_refresh")[0].cloneNode(),t=document.getElementsByName("c_clearAll")[0].cloneNode();form.appendChild(e),form.appendChild(t)}if("/sitecore/admin/cache.aspx"==window.location.pathname){const e=document.createElement("div");e.setAttribute("id","enhanced-table"),document.body.appendChild(e);const t=chrome.runtime.getURL("images/ram.png"),n=getData();new Tabulator("#enhanced-table",{data:n,layout:"fitDataFill",responsiveLayout:"hide",tooltips:!0,addRowPos:"top",history:!0,pagination:"local",paginationSize:50,movableColumns:!0,resizableRows:!0,initialSort:[{column:"size",dir:"desc"}],columns:[{title:"Name",field:"name",formatter:function(e,n){return"<span style='font-weight:bold;'><img src='"+t+"' style='width:16px; height:16px; vertical-align: middle;' /> "+e.getValue()+"</span>"}},{title:"Count",field:"count"},{title:"Size",field:"size",sorter:(e,t)=>toBytes(e)-toBytes(t)},{title:"Delta",field:"delta",sorter:(e,t)=>toBytes(e)-toBytes(t),formatter:function(e,t){var n=e.getValue();return(n=n.split(" "))[0]>0?"<span style='color:#DC291E; font-weight:bold;'>"+n[0]+" "+n[1]+"</span>":n[0]+" "+n[1]}},{title:"Max size",field:"maxSize",sorter:(e,t)=>toBytes(e)-toBytes(t)},{title:"Use rate",field:"useRate",formatter:e=>e.getValue()+" %"},{title:"< 80%",field:"under80",formatter:"tickCross"}],rowFormatter:e=>{const t=e.getData().useRate;if(t<70)return;const n=-1*t+165;e.getCell("useRate").getElement().style.backgroundColor=`hsl(0, 100%, ${n}%)`}})}