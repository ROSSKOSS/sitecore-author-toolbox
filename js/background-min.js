let sxa_site,sc_site,contextMenuEE=!1,contextMenuCE=!1;function checkSiteSxa(e,o,t){var n=new URL(o.tab.url);chrome.cookies.getAll({},(function(e){for(var o in e)if(e[o].domain==n.hostname&&"sxa_site"==e[o].name&&"login"!=e[o].value){t({farewell:e[o].value});break}t({farewell:null})}))}function onClickHandler(e,o){console.table(o),"SitecoreAuthorToolbox"==e.menuItemId&&chrome.storage.sync.get(["domain_manager"],e=>{var t=e.domain_manager,n=new URL(o.url),r=!1;for(var c in t)if(n.origin==t[c]){n=c+n.pathname,r=!0;break}r||(n=n.origin+n.pathname),chrome.tabs.executeScript(o.id,{code:'window.open("'+n+'?sc_mode=edit")'})})}function getSitecoreCookie(e){chrome.cookies.get({url:e.url,name:"sitecore_userticket"},(function(e){if(e.value)return e.value}))}function showContextMenu(e){if(null!=e.url){var o=e.url.split("?"),t=(o=o[0]).includes("/sitecore/"),n=o.includes("http"),r=e.url.includes("sc_mode=edit"),c=o.includes("view-source:");e.url.includes("sc_itemid=");chrome.contextMenus.removeAll((function(){!n||c||t||r||chrome.contextMenus.create({title:"Edit in Experience Editor",contexts:["page"],id:"SitecoreAuthorToolbox"},()=>chrome.runtime.lastError)}))}}function setIcon(e){var o=!1;e.url&&(o=new URL(e.url));var t=e.url.split("?"),n=(t=t[0]).includes("/sitecore/"),r=t.includes("http"),c=t.includes("localhost:"),i=t.includes("view-source:"),a=!1;r&&!i&&o&&!c?chrome.cookies.getAll({url:o.origin},(function(o){for(var t in chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),o)if("sitecore_userticket"==o[t].name||o[t].name.includes("#lang")||o[t].name.includes("#sc_mode")){a=!0;break}a?(chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.browserAction.setBadgeText({text:"ON"}),chrome.storage.sync.get(["feature_contextmenu"],o=>{null==o.feature_contextmenu&&(o.feature_contextmenu=!1),o.feature_contextmenu&&showContextMenu(e)})):(chrome.browserAction.setBadgeBackgroundColor({color:"#777777"}),chrome.browserAction.setBadgeText({text:"OFF"}))})):n&&(chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.browserAction.setBadgeText({text:"ON"}))}chrome.runtime.onMessage.addListener((function(e,o,t){return console.log(e),"get_pagestatus"==e.greeting&&fetch(e.url).then((function(e){console.log(e),t({status:e.status,redirected:e.redirected})})).catch((function(e){console.log(e),t({error:e})})),e.greeting,"sxa_site"==e.greeting&&checkSiteSxa(e,o,t),!0})),chrome.tabs.onUpdated.addListener((function(e,o,t){chrome.tabs.getSelected(null,(function(e){setIcon(e)}))})),chrome.tabs.onActivated.addListener((function(e,o,t){chrome.tabs.getSelected(null,(function(e){setIcon(e)}))})),chrome.runtime.setUninstallURL("https://uquaisse.io/sitecore-cms/uninstallation-successful/?utm_source=uninstall&utm_medium=chrome"),chrome.runtime.onInstalled.addListener((function(e){let o=chrome.runtime.getManifest().version,t=o.split(".");t[0],t[1],t[2];chrome.storage.sync.get(e=>{console.table(e),console.table(e.scData),console.table(e.domain_manager)}),"install"==e.reason||"update"==e.reason&&(o!=e.previousVersion?(console.log("Updated from "+e.previousVersion+" to "+o),new Notification("Extension updated!",{body:"Version "+o,icon:chrome.runtime.getURL("images/icon.png")})):console.log("Reload")),chrome.contextMenus.onClicked.addListener(onClickHandler),chrome.declarativeContent.onPageChanged.removeRules(void 0,(function(){chrome.declarativeContent.onPageChanged.addRules([{conditions:[new chrome.declarativeContent.PageStateMatcher({pageUrl:{urlContains:"/sitecore/"}}),new chrome.declarativeContent.PageStateMatcher({pageUrl:{urlContains:"sc_mode="}})],actions:[new chrome.declarativeContent.ShowPageAction]}])}))}));