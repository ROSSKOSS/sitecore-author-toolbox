"use strict";let sxa_site,sc_site,contextMenuEE=!1,contextMenuCE=!1;function checkSiteSxa(e,o,t){var n=new URL(o.tab.url);chrome.cookies.getAll({},(function(e){for(var o in e)if(e[o].domain==n.hostname&&"sxa_site"==e[o].name&&"login"!=e[o].value){t({farewell:e[o].value});break}t({farewell:null})}))}function onClickHandler(e,o){console.info("info: "+JSON.stringify(e)),console.info("tab: "+JSON.stringify(o));var t=e.pageUrl.substring(0,e.pageUrl.indexOf("?"));sc_site=null!=sxa_site?"&sc_site="+sxa_site:"","SitecoreAuthorToolbox"==e.menuItemId?chrome.tabs.executeScript(o.id,{code:'window.location.href = "'+t+"?sc_mode=edit"+sc_site+'";'}):"SitecoreAuthorToolboxEditor"==e.menuItemId&&chrome.tabs.executeScript(o.id,{code:'window.location.href = "'+t+"?sc_debug=1&sc_trace=1&sc_prof=1&sc_ri=1"+sc_site+'";'})}function showContextMenu(e){if(null!=e.url){var o=e.url.split("?"),t=(o=o[0]).includes("/sitecore/"),n=o.includes("http"),c=e.url.includes("sc_mode=edit"),r=o.includes("view-source:");e.url.includes("sc_itemid=");n&&!r&&chrome.cookies.get({url:e.url,name:"sxa_site"},(function(n){o=new URL(e.url),n&&!t&&(sxa_site=n.value,c?contextMenuCE||(chrome.contextMenus.create({title:"Debug this page (beta)",contexts:["page"],id:"SitecoreAuthorToolboxEditor"}),contextMenuCE=!0,contextMenuEE&&(chrome.contextMenus.remove("SitecoreAuthorToolbox"),contextMenuEE=!1)):contextMenuEE||(chrome.contextMenus.create({title:"Edit in Experience Editor (beta)",contexts:["page"],id:"SitecoreAuthorToolbox"}),contextMenuEE=!0,contextMenuCE&&(chrome.contextMenus.remove("SitecoreAuthorToolboxEditor"),contextMenuCE=!1)))}))}}function setIcon(e){var o=e.url.split("?"),t=(o=o[0]).includes("/sitecore/"),n=o.includes("http"),c=o.includes("view-source:");n&&!c?chrome.cookies.get({url:e.url,name:"sitecore_userticket"},(function(e){chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),e?(chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.browserAction.setBadgeText({text:"ON"})):(chrome.browserAction.setBadgeBackgroundColor({color:"#777777"}),chrome.browserAction.setBadgeText({text:"OFF"}))})):t&&(chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.browserAction.setBadgeText({text:"ON"}))}chrome.runtime.onMessage.addListener((function(e,o,t){return"sxa_site"==e.greeting&&checkSiteSxa(e,o,t),!0})),chrome.tabs.onUpdated.addListener((function(e,o,t){chrome.tabs.getSelected(null,(function(e){showContextMenu(e),setIcon(e)}))})),chrome.tabs.onActivated.addListener((function(e,o,t){chrome.tabs.getSelected(null,(function(e){showContextMenu(e),setIcon(e)}))})),chrome.runtime.onInstalled.addListener((function(e){if("install"==e.reason)console.log("This is a first install!"),chrome.tabs.create({url:"https://ugo-quaisse.github.io/sitecore-author-toolbox/"});else if("update"==e.reason){var o=chrome.runtime.getManifest().version;o!=e.previousVersion?(console.log("Updated from "+e.previousVersion+" to "+o),chrome.tabs.create({url:"https://ugo-quaisse.github.io/sitecore-author-toolbox/?v="+o})):console.log("Just a refresh ("+o+")")}chrome.contextMenus.onClicked.addListener(onClickHandler),chrome.declarativeContent.onPageChanged.removeRules(void 0,(function(){chrome.declarativeContent.onPageChanged.addRules([{conditions:[new chrome.declarativeContent.PageStateMatcher({pageUrl:{urlContains:"/sitecore/"}}),new chrome.declarativeContent.PageStateMatcher({pageUrl:{urlContains:"sc_mode="}})],actions:[new chrome.declarativeContent.ShowPageAction]}])}))}));