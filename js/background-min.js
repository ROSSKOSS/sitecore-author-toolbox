let e;function o(e,o){console.table(o),"SitecoreAuthorToolbox"==e.menuItemId&&chrome.storage.sync.get(["domain_manager"],(function(e){var t=e.domain_manager,n=new URL(o.url),r=!1;for(var c in t)if(n.origin==t[c]){n=c+n.pathname,r=!0;break}r||(n=n.origin+n.pathname),chrome.tabs.executeScript(o.id,{code:'window.open("'+n+'?sc_mode=edit")'})}))}function t(o){var t=o.url.split("?"),n=(t=t[0]).includes("/sitecore/"),r=t.includes("http"),c=t.includes("view-source:");r&&!c?chrome.cookies.get({url:o.url,name:"sitecore_userticket"},(function(t){chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),t?(chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.browserAction.setBadgeText({text:"ON"}),chrome.storage.sync.get(["feature_contextmenu"],(function(t){null==t.feature_contextmenu&&(t.feature_contextmenu=!1),t.feature_contextmenu&&function(o){if(null!=o.url){var t=o.url.split("?"),n=(t=t[0]).includes("/sitecore/"),r=t.includes("http"),c=o.url.includes("sc_mode=edit"),i=t.includes("view-source:");o.url.includes("sc_itemid=");r&&!i&&chrome.cookies.get({url:o.url,name:"sxa_site"},(function(r){t=new URL(o.url),!r||n||c||(e=r.value,chrome.contextMenus.removeAll((function(){chrome.contextMenus.create({title:"Edit in Experience Editor",contexts:["page"],id:"SitecoreAuthorToolbox"},()=>chrome.runtime.lastError)})))}))}}(o)}))):(chrome.browserAction.setBadgeBackgroundColor({color:"#777777"}),chrome.browserAction.setBadgeText({text:"OFF"}))})):n&&(chrome.browserAction.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.browserAction.setBadgeText({text:"ON"}))}chrome.runtime.onMessage.addListener((function(e,o,t){return"sxa_site"==e.greeting&&function(e,o,t){var n=new URL(o.tab.url);chrome.cookies.getAll({},(function(e){for(var o in e)if(e[o].domain==n.hostname&&"sxa_site"==e[o].name&&"login"!=e[o].value){t({farewell:e[o].value});break}t({farewell:null})}))}(0,o,t),"hide_tab"==e.greeting&&t({farewell:"Ok roger that!"}),"hide_snackbar"==e.greeting&&chrome.storage.sync.set({hideSnackbar:e.version},(function(){t({farewell:"Ok roger that! I hide version "+e.version})})),!0})),chrome.tabs.onUpdated.addListener((function(e,o,n){chrome.tabs.getSelected(null,(function(e){t(e)}))})),chrome.tabs.onActivated.addListener((function(e,o,n){chrome.tabs.getSelected(null,(function(e){t(e)}))})),chrome.runtime.onInstalled.addListener((function(e){let t=chrome.runtime.getManifest().version,n=t.split("."),r=n[0],c=n[1],i=n[2],a=[["Extension",t],["Major",r],["Minor",c],["Increment",i]];console.table(a),chrome.storage.sync.get((function(e){console.table(e),console.table(e.scData),console.table(e.domain_manager)})),"install"==e.reason?(console.log("Installation"),chrome.tabs.create({url:"https://uquaisse.io/extension-update/?utm_source=install&utm_medium=chrome&utm_campaign="+t})):"update"==e.reason&&(t!=e.previousVersion&&"0"==i?(console.log("Updated from "+e.previousVersion+" to "+t),chrome.tabs.create({url:"https://uquaisse.io/extension-update/?utm_source=upgrade&utm_medium=chrome&utm_campaign="+t})):t!=e.previousVersion?(console.log("Updated from "+e.previousVersion+" to "+t),new Notification("Extension updated!",{body:"Version "+t,icon:chrome.runtime.getURL("images/icon.png")})):console.log("Reload")),chrome.contextMenus.onClicked.addListener(o),chrome.declarativeContent.onPageChanged.removeRules(void 0,(function(){chrome.declarativeContent.onPageChanged.addRules([{conditions:[new chrome.declarativeContent.PageStateMatcher({pageUrl:{urlContains:"/sitecore/"}}),new chrome.declarativeContent.PageStateMatcher({pageUrl:{urlContains:"sc_mode="}})],actions:[new chrome.declarativeContent.ShowPageAction]}])}))}));