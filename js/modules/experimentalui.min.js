import*as global from"./global.js";import{exeJsCode,getScItemData,setTextColour}from"./helpers.js";export{insertSavebar,insertBreadcrumb,insertLanguageButton,insertVersionButton,insertMoreButton,insertNavigatorButton,insertLockButton,pathToBreadcrumb,initInsertIcon,getAccentColor,initColorPicker,initSitecoreMenu,initUserMenu,initGutter,getParentNode};const insertSavebar=()=>{let scPrimaryBtn,scLiveyBtn,scSaveBar='<div class="scSaveBar">\n        <div class="scActions">\n            '+(global.hasModePreview?'<button class="primary scExitButton" onclick="javascript:return scForm.invoke(\'contenteditor:closepreview\', event)">Close Panel</button>':'<button id="scPublishMenuMore" class="grouped" type="button">▾</button>\n            <ul class="scPublishMenu">            \n                <li onclick="javascript:return scForm.invoke(\'item:setpublishing\', event)">Unpublish...</li>\n                <li onclick="javascript:return scForm.postEvent(this,event,\'item:publishingviewer(id=)\')">Scheduler...</li>\n            </ul>\n            <button class="primary primaryGrouped" onclick="javascript:return scForm.postEvent(this,event,\'item:publish(id=)\')">Save and Publish</button>')+'\n            <button class="scSaveButton" onclick="javascript:return scForm.invoke(\'contenteditor:save\', event)">Save</button>\n            '+(global.hasModePreview?"":'<button class="scPreviewButton" disabled>...</button>')+'\n        </div>\n        <div class="scBreadcrumb"></div>\n    </div>',contentEditor=document.querySelector("#ContentEditor");document.querySelector(".scSaveBar")&&document.querySelector(".scSaveBar").remove(),contentEditor&&contentEditor.insertAdjacentHTML("afterbegin",scSaveBar);let scSaveMessage='<div class="saveMessage">Your changes have been saved successfully!</div>';!document.querySelector(".saveMessage")&&document.querySelector("body").insertAdjacentHTML("afterbegin",scSaveMessage)},pathToBreadcrumb=(pathname,delimiter="/",underline=!0)=>{let breadcrumb="#####",count=0,elipsis=!1;if(pathname){let path=pathname.toLowerCase()+"/";path=path.split("/home/"),null!=path[1]?(path=path[1].split("/"),breadcrumb+=underline?'<u class="home" onclick="javascript:return scForm.invoke(\'contenteditor:home\', event)">Home</u> ':"Home "):path=path[0].split("/");for(let level of path)count++,path.length>8&&count>3&&count<path.length-2?elipsis||(""!=level&&(breadcrumb+="<i>"+delimiter+"</i> [...] "),elipsis=!0):underline?""!=level&&(breadcrumb+="<i>"+delimiter+'</i> <u onclick="getParentNode('+(path.length-count-1)+", '"+global.tabLoadingTitle+"');\">"+level.toLowerCase().capitalize()+"</u> "):""!=level&&(breadcrumb+="<i>"+delimiter+"</i> "+level.toLowerCase().capitalize()+" ")}return breadcrumb=breadcrumb.replace("#####<i>"+delimiter+"</i>","").replace("#####",""),breadcrumb},insertBreadcrumb=path=>{let breadcrumb=pathToBreadcrumb(path),scBreadcrumb=document.querySelector(".scBreadcrumb");scBreadcrumb&&path&&(scBreadcrumb.innerHTML=breadcrumb)},insertLanguageButton=(scItemId,scLanguage="EN",scVersion=1)=>{let container=document.querySelector(".scEditorTabControlsHolder"),button='<button class="scEditorHeaderButton" id="scLanguageButton" type="button"><img src="'+global.iconLanguage+'" class="scLanguageIcon"> '+scLanguage+" ▾</button>";container&&container.insertAdjacentHTML("afterbegin",button),document.querySelector("#scLanguageIframe")&&document.querySelector("#scLanguageIframe").remove();let body=document.querySelector("body"),iframe='<iframe loading="lazy" id="scLanguageIframe" src="/sitecore/shell/default.aspx?xmlcontrol=Gallery.Languages&id='+scItemId+"&la="+scLanguage+"&vs="+scVersion+'&db=master"></iframe>';body&&body.insertAdjacentHTML("beforeend",iframe),document.querySelector(".scEditorTabControls")&&document.querySelector(".scEditorTabControls").remove()},insertMoreButton=()=>{let container=document.querySelector(".scEditorTabControlsHolder"),ScItem=getScItemData(),button='<button class="scEditorHeaderButton" id="scMoreButton" title="More actions" type="button">\n    <img src="'+global.iconMore+'" class="scLanguageIcon">\n    </button>\n    <ul class="scMoreMenu">\n        <li onclick="javascript:return scForm.invoke(\'contenteditor:edit\')" id="scLockMenuText">Lock item</li>\n        <li onclick="javascript:if(confirm(\'Do you really want to create a new version for this item?\')) { return scForm.postEvent(this,event,\'item:addversion(id=)\') }">Add new version</li>\n        <li onclick="javascript:return scForm.postEvent(this,event,\'item:rename\')">Rename item</li>\n        <li onclick="javascript:return scForm.invoke(\'item:duplicate\')">Duplicate</li>\n        <li class="separator" onclick="javascript:return scForm.postEvent(this,event,\'webedit:openexperienceeditor\')">Edit in Experience Editor...</li>\n        <li class="separator"  onclick="javascript:return scForm.postEvent(this,event,\'item:sethelp\')">Help texts</li>\n        <li id="scInfoButton">Item details</li>\n        <li onclick="javascript:return scForm.postEvent(this,event,\'item:executescript(id='+ScItem.id+',db=master,script={1876D433-4FAE-46B2-B2EF-AAA0FDA110E7},scriptDb=master)\')">Author statistics</li>\n        <li class="separator danger" onclick="javascript:return scForm.invoke(\'item:delete(id='+ScItem.id+")', event)\">Delete</li>\n    </ul>";container&&container.insertAdjacentHTML("afterbegin",button);let panel=document.querySelector("#scPanel"),html='<div class="content">\n        <h2>Item details</h2>\n        <h3>Item ID:</h3>\n        '+ScItem.id+"\n        <h3>Name:</h3>\n    "+ScItem.name+"\n        <h3>Path:</h3>\n    "+ScItem.path+"\n        <h3>Template:</h3>\n    "+ScItem.template+"\n        <h3>Template ID:</h3>\n    "+ScItem.templateId+"\n        <h3>From:</h3>\n    "+ScItem.from+"\n        <h3>Owner:</h3>\n    "+ScItem.owner+"\n        <h3>Language:</h3>\n    "+ScItem.language+"\n        <h3>Version:</h3>\n    "+ScItem.version+"\n    </div>";panel&&(panel.innerHTML=html),document.querySelector(".scEditorTabControls")&&document.querySelector(".scEditorTabControls").remove()},insertVersionButton=(scItemId,scLanguage="EN",scVersion=1)=>{let container=document.querySelector(".scEditorTabControlsHolder"),button='<button class="scEditorHeaderButton" id="scVersionButton" type="button"><img src="'+global.iconVersion+'" class="scLanguageIcon"> '+scVersion+" ▾</button>";container&&null!=scVersion&&container.insertAdjacentHTML("afterbegin",button),document.querySelector("#scVersionIframe")&&document.querySelector("#scVersionIframe").remove();let body=document.querySelector("body"),iframe='<iframe loading="lazy" id="scVersionIframe" src="/sitecore/shell/default.aspx?xmlcontrol=Gallery.Versions&id='+scItemId+"&la="+scLanguage+"&vs="+scVersion+'&db=master"></iframe>';body&&body.insertAdjacentHTML("beforeend",iframe),document.querySelector(".scEditorTabControls")&&document.querySelector(".scEditorTabControls").remove()},insertNavigatorButton=()=>{let container=document.querySelector(".scEditorTabControlsHolder"),button='<button class="scEditorHeaderButton" id="scNavigatorButton" type="button"><img src="'+global.iconNotebook+'" class="scLanguageIcon"> ▾</button>';container&&container.insertAdjacentHTML("afterbegin",button),document.querySelector(".scEditorTabControls")&&document.querySelector(".scEditorTabControls").remove()},insertLockButton=(locked=!1)=>{let icon=0==locked?global.iconUnlocked:global.iconLocked,container=document.querySelector(".scEditorTabControlsHolder"),button='<button onclick="javascript:return scForm.postEvent(this,event,\'item:checkout\')" class="scEditorHeaderButton" id="scLockButton" title="Lock this item" type="button"><img src="'+icon+'" class="scLanguageIcon"></button>';container&&container.insertAdjacentHTML("afterbegin",button),document.querySelector(".scEditorTabControls")&&document.querySelector(".scEditorTabControls").remove()},initSitecoreMenu=()=>{let storage=localStorage.getItem("scSitecoreMenu"),dock=document.querySelector(".scDockTop"),icon=document.querySelector("#scSitecoreMenu");"true"==storage?(dock&&dock.classList.add("showSitecoreMenu"),icon&&icon.classList.add("scSitecoreMenu")):(dock&&dock.classList.remove("showSitecoreMenu"),icon&&icon.classList.remove("scSitecoreMenu"))},getAccentColor=()=>{let color,text,brightness,invert,storage=localStorage.getItem("scColorPicker"),root=document.documentElement;return storage?(color=storage,text=setTextColour(color),brightness="#ffffff"==text?10:0,invert="#ffffff"==text?1:0,root.style.setProperty("--accent",color),root.style.setProperty("--accentText",text),root.style.setProperty("--accentBrightness",brightness),root.style.setProperty("--accentInvert",invert)):(color="#ee3524",root.style.setProperty("--accent","#ee3524"),root.style.setProperty("--accentText","#ffffff"),root.style.setProperty("--accentBrightness",50),root.style.setProperty("--accentInvert",1)),color},initColorPicker=()=>{let color,text,brightness,invert,input='<input type="color" id="scAccentColor" name="scAccentColor" value="'+getAccentColor()+'" class="t-bottom2 t-sm" data-tooltip="Choose your accent color">',menu=document.querySelector(".sc-accountInformation");menu&&menu.insertAdjacentHTML("afterbegin",input);let colorPicker=document.querySelector("#scAccentColor");colorPicker&&colorPicker.addEventListener("change",()=>{color=colorPicker.value,text=setTextColour(color),brightness="#ffffff"==text?10:0,invert="#ffffff"==text?1:0;let root=document.documentElement;root.style.setProperty("--accent",color),root.style.setProperty("--accentText",text),root.style.setProperty("--accentBrightness",brightness),root.style.setProperty("--accentInvert",invert),document.querySelectorAll("iframe").forEach((function(e){let iframe=e.contentWindow.document.documentElement;iframe.style.setProperty("--accent",color),iframe.style.setProperty("--accentText",text),iframe.style.setProperty("--accentBrightness",brightness),iframe.style.setProperty("--accentInvert",invert)})),localStorage.setItem("scColorPicker",color)})},initUserMenu=()=>{let accountInformation=document.querySelector(".sc-accountInformation"),startButton=document.querySelector(".sc-globalHeader-startButton");if(accountInformation){let dialogParamsLarge="center:yes; help:no; resizable:yes; scroll:yes; status:no; dialogMinHeight:200; dialogMinWidth:300; dialogWidth:1100; dialogHeight:700; header:",htmlApp='<div class="sc-globalheader-appName" onclick="javascript:return scForm.invoke(\'contenteditor:home\', event)">Content Editor</div>';startButton&&startButton.insertAdjacentHTML("afterend",htmlApp);let htmlIcon='<img loading="lazy" id="scNotificationBell" onclick="javascript:scSitecore.prototype.showModalDialog(\''+global.workboxPage.replace("&sc_bw=1","&sc_bw=0")+"', '', '"+dialogParamsLarge+'Workbox\', null, null); false" src="'+global.iconBell+'" class="scIconMenu" accesskey="w" />\n        <img loading="lazy" title="Show ribbon" id="scSitecoreMenu" onclick="showSitecoreMenu()" src="'+global.iconDownArrow+'" class="scIconMenu" accesskey="a" />';accountInformation.insertAdjacentHTML("afterbegin",htmlIcon);let accountUser=accountInformation.querySelectorAll("li")[1].innerText.trim();accountInformation.querySelector("li").remove(),accountInformation.querySelector("li").innerHTML=accountInformation.querySelector("li > img").outerHTML,accountInformation.querySelector("li > img").setAttribute("id","globalHeaderUserPortrait");let htmlMenu='\n        <ul class="scAccountMenu">\n            <li onclick="javascript:return scForm.invoke(\'preferences:changeuserinformation\', event)">My account ('+accountUser+")</li>\n            <li onclick=\"javascript:return scForm.invoke('security:changepassword', event) \">Change Password</li>\n            <li onclick=\"javascript:return scForm.invoke('shell:useroptions', event)\">Application Options</li>\n            <li onclick=\"window.open('"+global.launchpadPage+"')\">Sitecore Author Toolbox Options</li>\n            <li onclick=\"javascript:return scForm.invoke('preferences:changeregionalsettings', event)\">Region and Languages</li>\n            <li onclick=\"javascript:return scForm.invoke('system:showlicenses', event)\">Licences</li>\n            <li onclick=\"javascript:return scForm.invoke('system:showabout', event)\">Licence details</li>\n            <li onclick=\"javascript:return scForm.invoke('contenteditor:close', event)\">Log out</li>\n        </ul>";accountInformation.insertAdjacentHTML("afterbegin",htmlMenu),document.addEventListener("keydown",event=>{event.ctrlKey&&"Shift"===event.key&&(exeJsCode("showSitecoreMenu()"),event.preventDefault(),event.stopPropagation())}),document.querySelector(".scAccountMenu")&&document.addEventListener("click",event=>{"globalHeaderUserPortrait"==event.srcElement.id?document.querySelector(".scAccountMenu").setAttribute("style","visibility: visible; top: 50px; opacity: 1;"):document.querySelector(".scAccountMenu").setAttribute("style","visibility: hidden; top: 40px; opacity: 0;")}),document.querySelector("#DesktopLinks")&&document.querySelector("#DesktopLinks").addEventListener("click",()=>{document.querySelector(".scAccountMenu").setAttribute("style","visibility: hidden; top: 40px; opacity: 0;")})}},setInsertIcon=treeNode=>{let id=treeNode.replace("Tree_Node_",""),a=document.querySelector("#Tree_Node_"+id),itemName=a.querySelector("span").innerText,active,activeClass="";id==(!!document.querySelector(".scContentTreeNodeActive")&&document.querySelector(".scContentTreeNodeActive").id.replace("Tree_Node_",""))&&(activeClass="scInsertItemIconInverted"),document.querySelectorAll(".scInsertItemIcon").forEach(el=>{el.remove()}),a.insertAdjacentHTML("afterend",'<span id="scIcon'+id+'" title="Insert under this node" class="scInsertItemIcon '+activeClass+'" onclick="insertPage(\''+id+"', '"+itemName+"')\"></span>");let target=document.querySelector("#scIcon"+id);target&&target.setAttribute("style","opacity:1"),document.querySelector(".scInsertItemIcon").addEventListener("mouseenter",(function(){let parent;document.querySelector(".scInsertItemIcon").parentNode.querySelector("a > span").setAttribute("style","background-color: var(--grey5)")})),document.querySelector(".scInsertItemIcon").addEventListener("mouseleave",(function(){let parent;document.querySelector(".scInsertItemIcon").parentNode.querySelector("a > span").setAttribute("style","")})),document.querySelectorAll(".scEditItemIcon").forEach(el=>{el.remove()}),a.insertAdjacentHTML("afterend",'<span id="scIconEE'+id+'" title="Edit in Experience Editor" class="scEditItemIcon '+activeClass+'" onclick="javascript:return scForm.postEvent(this,event,\'webedit:openexperienceeditor(id={'+id.replace(/([0-z]{8})([0-z]{4})([0-z]{4})([0-z]{4})([0-z]{12})/u,"$1-$2-$3-$4-$5")+"})')\"></span>"),target=document.querySelector("#scIconEE"+id),target&&target.setAttribute("style","opacity:1"),document.querySelector(".scEditItemIcon").addEventListener("mouseenter",(function(){let parent;document.querySelector(".scEditItemIcon").parentNode.querySelector("a > span").setAttribute("style","background-color: var(--grey5)")})),document.querySelector(".scEditItemIcon").addEventListener("mouseleave",(function(){let parent;document.querySelector(".scEditItemIcon").parentNode.querySelector("a > span").setAttribute("style","")}))},initInsertIcon=()=>{let contentTree=document.querySelector(".scContentTree"),treeNode=document.querySelector(".scContentTreeContainer"),node,nodeIcon,nodeContent;treeNode&&(treeNode.addEventListener("mouseover",event=>{(event.path[1].classList.contains("scContentTreeNodeNormal")||event.path[1].classList.contains("scContentTreeNodeActive"))&&(setInsertIcon(event.path[1].getAttribute("id")),node=event.path[1]),(event.path[2].classList.contains("scContentTreeNodeNormal")||event.path[2].classList.contains("scContentTreeNodeActive"))&&(setInsertIcon(event.path[2].getAttribute("id")),node=event.path[2]),node&&!node.classList.contains("scNoOverlap")&&(nodeIcon=node.querySelector("span > img").src,nodeContent=node.querySelector("span").innerText,node.querySelector("span").innerHTML='<img src="'+nodeIcon+'" width="16" height="16" class="scContentTreeNodeIcon" alt="" border="0"><div>'+nodeContent+"</div>",node.classList.add("scNoOverlap"))}),contentTree.addEventListener("mouseleave",()=>{document.querySelector(".scInsertItemIcon")&&document.querySelector(".scInsertItemIcon").setAttribute("style","opacity:0"),document.querySelector(".scEditItemIcon")&&document.querySelector(".scEditItemIcon").setAttribute("style","opacity:0")}))},initGutter=()=>{let treeNode=document.querySelector(".scContentTreeContainer"),html='<div class="scGutter" onclick="javascript:if (window.scGeckoActivate) window.scGeckoActivate(); return scContent.onTreeClick(this, event)" oncontextmenu="javascript:return scContent.onTreeContextMenu(this, event)" onkeydown="javascript:return scContent.onTreeKeyDown(this, event)"></div>';treeNode&&treeNode.insertAdjacentHTML("afterbegin",html)},getParentNode=(int=1)=>{for(var elem=parent.document.querySelector(".scContentTreeNodeActive"),count=0;elem&&elem!==document;elem=elem.parentNode)if(elem.classList&&elem.classList.contains("scContentTreeNode")&&++count==1+int){elem.querySelector(".scContentTreeNodeNormal").getAttribute("id").replace("Tree_Node_","").replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/u,"$1-$2-$3-$4-$5");break}};