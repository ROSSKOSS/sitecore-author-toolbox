var debug=!1;function stripHtml(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}function sendNotification(e,t){new Notification(e,{body:t,icon:chrome.runtime.getURL("images/icon.png")})}var script=document.createElement("script");script.src=chrome.runtime.getURL("js/BucketList.js"),(document.head||document.documentElement).appendChild(script),script.remove();var link=document.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=chrome.runtime.getURL("css/onload-min.css"),document.getElementsByTagName("head")[0].appendChild(link),debug&&console.info("***** URL loaded ***** "+window.location);var isGalleryLanguage=window.location.href.includes("Gallery.Language"),isGalleryFavorites=window.location.href.includes("Gallery.Favorites"),isAdminCache=window.location.href.includes("/admin/cache.aspx"),isMediaBrowser=window.location.href.includes("Sitecore.Shell.Applications.Media.MediaBrowser"),isPublishWindow=window.location.href.includes("/shell/Applications/Publish.aspx"),isSecurityWindow=window.location.href.includes("/shell/Applications/Security/"),isExperienceEditor=window.location.href.includes("/Applications/ExperienceEditor/"),isContentHome=window.location.href.includes("/content/home"),isLoginPage=window.location.href.includes("sitecore/login"),isLaunchpad=window.location.href.includes("/client/Applications/Launchpad"),isDesktop=window.location.href.includes("/shell/default.aspx"),isRichTextEditor=window.location.href.includes("/Controls/Rich%20Text%20Editor/"),launchpadPage=chrome.runtime.getURL("options.html"),launchpadIcon=chrome.runtime.getURL("images/icon.png"),launchpadGroupTitle="Sitecore Author Toolbox",launchpadTitle="Options",launchpadUrl=window.location.href;if(isDesktop){debug&&console.info("====================> DESKTOP <====================");var html='<a href="#" class="scStartMenuLeftOption" title="" onclick="window.location.href=\''+launchpadPage+"?launchpad=true&url="+launchpadUrl+'\'"><img src="'+launchpadIcon+'" class="scStartMenuLeftOptionIcon" alt="" border="0"><div class="scStartMenuLeftOptionDescription"><div class="scStartMenuLeftOptionDisplayName">'+launchpadGroupTitle+'</div><div class="scStartMenuLeftOptionTooltip">'+launchpadTitle+"</div></div></a>",desktopOptionMenu=document.querySelectorAll(".scStartMenuLeftOption");for(let e of desktopOptionMenu)"Install and maintain apps."==e.getAttribute("title")&&e.insertAdjacentHTML("afterend",html)}else isLaunchpad&&(debug&&console.info("====================> LAUNCHPAD <===================="),chrome.storage.sync.get(["feature_launchpad"],(function(e){if(null==e.feature_launchpad&&(e.feature_launchpad=!0),e.feature_launchpad){var t=document.querySelectorAll(".last"),n='<div class="sc-launchpad-group"><header class="sc-launchpad-group-title">'+launchpadGroupTitle+'</header><div class="sc-launchpad-group-row"><a href="#" onclick="window.location.href=\''+launchpadPage+"?launchpad=true&url="+launchpadUrl+'\'" class="sc-launchpad-item" title="'+launchpadTitle+'"><span class="icon"><img src="'+launchpadIcon+'" width="48" height="48" alt="'+launchpadTitle+'"></span><span class="sc-launchpad-text">'+launchpadTitle+"</span></a></div></div>";t[0].insertAdjacentHTML("afterend",n)}})));if(isGalleryLanguage)debug&&console.info("====================> LANGUAGES <===================="),chrome.storage.sync.get(["feature_flags"],(function(e){if(null==e.feature_flags&&(e.feature_flags=!0),e.feature_flags){var t,n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",chrome.runtime.getURL("data/languages.json"),!0),n.onreadystatechange=function(){if(4===n.readyState&&"200"==n.status){t=JSON.parse(n.responseText);var e,a,s,r,o,i=document.getElementById("Languages").querySelectorAll(".scMenuPanelItem,.scMenuPanelItemSelected"),l=0;for(let n of i){l=0,e=n.getElementsByTagName("td");for(let n of e){if(0==l)s=n.getElementsByTagName("img");else{if(a=(a=n.getElementsByTagName("b"))[0].innerHTML,"0"!=n.getElementsByTagName("div")[2].innerHTML.split(" ")[0]&&(r=n.getElementsByTagName("div"))[2].setAttribute("style","background-color: yellow; display: initial; padding: 0px 3px; color: #000000 !important"),a.includes("(region)"))for(o in a=a.split(" (region"),t)t.hasOwnProperty(o)&&a[0].toUpperCase()==t[o].language.toUpperCase()&&(a=t[o].flag);else(r=(r=(r=null==(r=a.split(" ("))[1]?r[0]:r[1]).split(")"))[0].split(" :"))[0].includes(", ")&&((r=r[0].split(", "))[0]=r[1],r[0]=r[0].replace(" ","_")),a=(a=(a=(a=(a=(a=(a=(r=(r=r[0].replace(" ","_")).toUpperCase()).replace("TRADITIONAL,_","")).replace("SIMPLIFIED,_","")).replace("U.A.E.","UNITED_ARAB_EMIRATES")).replace("KOREA","SOUTH_KOREA")).replace("UNITED_STATES","USA")).replace("UNITED_KINGDOM","GREAT_BRITAIN")).replace("ENGLISH","GREAT_BRITAIN");a=a.toLowerCase(),s[0].onerror=function(){this.src=chrome.runtime.getURL("images/Flags/32x32/flag_generic.png")},s[0].src=chrome.runtime.getURL("images/Flags/32x32/flag_"+a+".png")}l++}0}}},n.send(null)}}));else if(isPublishWindow){debug&&console.info("====================> PUBLISH WINDOW <====================");var dom=document.getElementById("Languages"),label=dom.getElementsByTagName("label");for(let e of label);}else isGalleryFavorites?debug&&console.info("====================> FAVORITES <===================="):isMediaBrowser?debug&&console.info("====================> MEDIA BROWSER <===================="):isAdminCache&&debug&&console.info("====================> ADMIN CACHE <====================");function _addEnvironmentLabel(){var e=0,t=chrome.runtime.getURL("images/rocket.png"),n=chrome.runtime.getURL("images/error.png"),a=chrome.runtime.getURL("images/edit.png"),s=chrome.runtime.getURL("images/Flags/32x32/flag_generic.png"),r=chrome.runtime.getURL("data/languages.json");let o=["ARABIC","HEBREW","PERSIAN","URDU","SINDHI"],i=document.querySelector(".scEditorHeader");document.querySelector(".scEditorHeaderTitle");document.getElementsByClassName("scEditorQuickInfo");let l=document.querySelector(".scEditorHeaderQuickInfoInput"),c=document.querySelector(".scEditorHeaderVersionsLanguage"),d=document.querySelector(".scEditorTabHeaderActive");var u=document.getElementsByClassName("scValidationMarkerIcon");let g=document.querySelector("#EditorFrames"),m=(document.getElementById("SearchPanel"),document.getElementById("ContentTreeHolder"));if(l){var p=document.getElementsByClassName("scEditorHeaderQuickInfoInput"),f=p[0].getAttribute("value"),h=p[1].getAttribute("value"),v=h,y=!1,E=(h=h.split("/Home/"))[0];E=(E=E.split("/")).slice(-1)[0],"Data"==(p=v.split("/"))[p.length-1]&&(y=!0);var I,b=document.getElementById("scLanguage").getAttribute("value").toLowerCase(),T=window.location.origin+"/?sc_itemid="+f+"&sc_mode=normal&sc_lang="+b,B=(p=document.getElementsByClassName("scEditorHeaderVersionsLanguage"))[0].getAttribute("title"),L=stripHtml(p[0].innerHTML),_=L.includes("("),M=(h=null!=h[1]?encodeURI(window.location.origin+"/"+b+"/"+h[1]+"?sc_site="+E+"&sc_mode=normal").toLowerCase():encodeURI(window.location.origin+"/"+b+"/?sc_site="+E).toLowerCase()).includes("/data/");y||h==encodeURI(window.location.origin+"/"+b+"/?sc_site="+E).toLowerCase()||M||chrome.storage.sync.get(["feature_urls"],(function(e){if(null==e.feature_urls&&(e.feature_urls=!0),!document.getElementById("scMessageBarUrl")&&e.feature_urls){var n='<div id="scMessageBarUrl" class="scMessageBar scWarning"><div class="scMessageBarIcon" style="background-image:url('+t+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">Sitecore Live URL</div><div class="scMessageBarText">If you want to preview this page in <b>'+B+'</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+h+'" target="_blank" class="scMessageBarOption">Open this link</a> or try <a href="'+T+'" target="_blank" class="scMessageBarOption">this alternative link</a></li></ul></div></div>';i.insertAdjacentHTML("afterend",n)}})),M&&(h=h.split("/data/"),chrome.storage.sync.get(["feature_urls"],(function(e){if(null==e.feature_urls&&(e.feature_urls=!0),!document.getElementById("scMessageBarInfo")&&e.feature_urls){var t='<div id="scMessageBarInfo" class="scMessageBar scInformation"><div class="scMessageBarIcon" style="background-image:url('+a+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">You are editing a data source...</div><div class="scMessageBarText">To see it, you need to add/edit it to your page via the</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+h[0]+'?sc_mode=edit" target="_blank" class="scMessageBarOption">Experience Editor</a></li></ul></div></div>';i.insertAdjacentHTML("afterend",t)}}))),chrome.storage.sync.get(["feature_flags"],(function(e){if(null==e.feature_flags&&(e.feature_flags=!0),_)(p=(p=(p=null==(p=L.split(" ("))[1]?p[0]:p[1]).split(")"))[0].split(" :"))[0].includes(", ")&&((p=p[0].split(", "))[0]=p[1],p[0]=p[0].replace(" ","_")),p=(p=p[0].replace(" ","_")).toUpperCase(),I=(I=p.replace("TRADITIONAL,_","")).replace("SIMPLIFIED,_",""),debug&&console.log("Flag:"+I),I=(I=(I=(I=(I=(I=I.replace("U.A.E.","UNITED_ARAB_EMIRATES")).replace("KOREA","SOUTH_KOREA")).replace("UNITED_STATES","USA")).replace("UNITED_KINGDOM","GREAT_BRITAIN")).replace("ENGLISH","GREAT_BRITAIN")).toLowerCase(),I=chrome.runtime.getURL("images/Flags/32x32/flag_"+I+".png"),!document.getElementById("scFlag")&&e.feature_flags&&I&&d.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+I+'" style="width: 20px; vertical-align: middle; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+s+"';\"/>"),!document.getElementById("scFlagMenu")&&e.feature_flags&&I&&c.insertAdjacentHTML("afterbegin",'<img id="scFlagMenu" src="'+I+'" style="width: 15px; vertical-align: sub; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+s+"';\"/>");else if(e.feature_flags){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",r,!0),t.onreadystatechange=function(){if(4===t.readyState&&"200"==t.status){var n,a=JSON.parse(t.responseText);for(n in a)a.hasOwnProperty(n)&&L.toUpperCase()==a[n].language.toUpperCase()&&(I=(I=a[n].flag).toLowerCase(),I=chrome.runtime.getURL("images/Flags/32x32/flag_"+I+".png"),debug&&console.log("Flag:"+I),!document.getElementById("scFlag")&&e.feature_flags&&I&&d.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+I+'" style="width: 20px; vertical-align: middle; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+s+"';\"/>"),!document.getElementById("scFlagMenu")&&e.feature_flags&&I&&c.insertAdjacentHTML("afterbegin",'<img id="scFlagMenu" src="'+I+'" style="width: 15px; vertical-align: sub; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+s+"';\"/>"))}},t.send(null)}}))}chrome.storage.sync.get(["feature_rtl"],(function(e){if(null==e.feature_rtl&&(e.feature_rtl=!0),e.feature_rtl){var t;if(p=L.split(" ("),I=p[0].toUpperCase(),(link=document.createElement("link")).type="text/css",link.rel="stylesheet",o.includes(I)){link.href=chrome.runtime.getURL("css/rtl-min.css"),t=document.getElementsByClassName("scContentControlHtml");for(let e of t)e.onload=function(){e.contentWindow.document.getElementById("ContentWrapper").style.direction="RTL"};debug&&console.log("RTE:"+I)}else{link.href=chrome.runtime.getURL("css/ltr-min.css"),t=document.getElementsByClassName("scContentControlHtml");for(let e of t)e.onload=function(){e.contentWindow.document.getElementById("ContentWrapper").style.direction="LTR"};debug&&console.log("LTR:"+I)}document.getElementsByTagName("head")[0].appendChild(link)}})),chrome.storage.sync.get(["feature_errors"],(function(t){if(null==t.feature_errors&&(t.feature_errors=!0),null!=u[0]&&t.feature_errors){e=0;var a='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+n+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let t of u)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=t.getAttribute("src")&&(a+='<li class="scMessageBarOptionBullet" onclick="'+t.getAttribute("onclick")+'" style="cursor:pointer;">'+t.getAttribute("title")+"</li>",e++);a+="</ul></div></div>",e>0&&i.insertAdjacentHTML("afterend",a);var s=document.querySelector(".scValidatorPanel");new MutationObserver((function(t){e=0;var a='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+n+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let t of u)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=t.getAttribute("src")&&(a+='<li class="scMessageBarOptionBullet" onclick="'+t.getAttribute("onclick")+'" style="cursor:pointer;">'+t.getAttribute("title")+"</li>",e++);if(a+="</ul></div></div>",e>0)i.insertAdjacentHTML("afterend",a);else{var s=document.getElementById("scMessageBarError");s&&s.parentNode.removeChild(s)}debug&&console.log("Changement: "+document.getElementsByClassName("scValidatorPanel"))})).observe(s,{attributes:!0,childList:!0,characterData:!0})}}));var A=document.getElementById("EditorFrames");if(A){var w,x,C;A=A.getElementsByTagName("iframe"),e=0;for(let t of A)if(w=A[e].src,x=A[e],C=w.includes("/Media/"),e++,C){debug&&console.info("SRC of MEDIA IFRAME "+e+" - "+w);break}chrome.storage.sync.get(["feature_dragdrop"],(function(e){if(null==e.feature_dragdrop&&(e.feature_dragdrop=!0),C&&e.feature_dragdrop)x.onload=function(){var e='<iframe id="sitecorAuthorToolbox" class="sitecorAuthorToolbox" src="'+("/sitecore/client/Applications/Dialogs/UploadMediaDialog?fo=sitecore://master/{"+(w=(w=w.split("id=%7B"))[1].split("%7B"))[0]+"}")+'" style="width:100%; height:500px; margin-top: -60px; resize: vertical;"></iframe>';x.setAttribute("style","margin-top: -30px;");var t=document.getElementById("sitecorAuthorToolbox");t&&(t.remove(),debug&&console.info("Remove iFrame from DOM")),g.insertAdjacentHTML("afterbegin",e)};else{var t=document.getElementById("sitecorAuthorToolbox");t&&(t.remove(),debug&&console.info("Remove iFrame from DOM (no folder)"))}}))}window.Notification?"granted"===Notification.permission||Notification.requestPermission().then((function(e){"granted"===e||console.info("User blocked notifications.")})).catch((function(e){console.warn(e)})):console.info("Browser does not support notifications."),chrome.storage.sync.get(["feature_favorites"],(function(e){if(null==e.feature_favorites&&(e.feature_favorites=!0),e.feature_favorites&&!isPublishWindow){var t=document.getElementById("sitecorAuthorToolboxFav");t&&t.remove();var n='<iframe id="sitecorAuthorToolboxFav" class="sitecorAuthorToolboxFav" src="'+("../default.aspx?xmlcontrol=Gallery.Favorites&id="+f+"&la="+b+"&vs=1")+'" style="width:100%; height:150px; margin-top: 0px; resize: vertical;"></iframe>';m.insertAdjacentHTML("afterend",n)}})),!0===debug&&(console.info("Item ID: "+f),console.info("Language: "+b),console.info("Version: na"))}chrome.storage.sync.get(["feature_darkmode"],(function(e){if(null==e.feature_darkmode&&(e.feature_darkmode=!1),e.feature_darkmode&&!isExperienceEditor&&!isAdminCache&&!isSecurityWindow&&!isContentHome&&!isLoginPage){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/default-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/ribbon-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/contentmanager-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/dialogs-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/gallery-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/speak-min.css"),document.getElementsByTagName("head")[0].appendChild(t)}}));var MutationObserver=window.MutationObserver,elementObserver=new MutationObserver((function(e){debug&&console.info("**Update UI**");var t=document.getElementsByClassName("scEditorHeaderQuickInfoInput"),n=t[0].getAttribute("value"),a=document.getElementById("scLanguage").getAttribute("value").toLowerCase(),s=document.querySelectorAll(".scEditorQuickInfo"),r=document.getElementsByClassName("scEditorHeaderTitle"),o=0,i=document.getElementById("showInContentTree");console.log(s);for(let e of s){if(o>0&&null==i){t=e.getElementsByClassName("scEditorHeaderQuickInfoInput"),n=t[0].getAttribute("value"),console.log("ID "+n);var l='[<a id="showInContentTree" href="" onclick="return scForm.invoke(\'item:load(id='+n+",language="+a+",version=1)')\" />Show in content tree</a>]";r[o].insertAdjacentHTML("afterend",l);break}o++}chrome.storage.sync.set({scItemID:n},(function(){debug&&console.info(">> Store ItemID: "+n)})),chrome.storage.sync.set({scLanguage:a},(function(){debug&&console.info(">> Store Language: "+a)})),e.forEach((function(e){"attributes"==e.type&&_addEnvironmentLabel()}))})),element=document.getElementById("scLanguage");if(element){debug&&console.info("**Reload**");var scLanguage=element.getAttribute("value").toLowerCase();chrome.storage.sync.get(["scItemID","feature_reloadnode"],(function(e){if(!chrome.runtime.error&&null!=e.scItemID&&(null==e.feature_reloadnode&&(e.feature_reloadnode=!0),e.scItemID&&1==e.feature_reloadnode)){var t='scForm.invoke("item:load(id='+e.scItemID+",language="+scLanguage+',version=1)");',n=document.createElement("script");n.textContent=t,(document.head||document.documentElement).appendChild(n),n.remove(),debug&&console.info(">> User Preference -----\x3e "+e.feature_reloadnode),debug&&console.info(">> GoTo ItemID -----\x3e  "+e.scItemID)}})),_addEnvironmentLabel(),elementObserver.observe(element,{attributes:!0})}var elementObserver2=new MutationObserver((function(e){e.forEach((function(e){"attributes"==e.type&&_addEnvironmentLabel()})),chrome.storage.sync.get(["feature_notification"],(function(e){if(null==e.feature_notification&&(e.feature_notification=!0),e.feature_notification){element2.getElementsByClassName("DialogHeader").item(0).innerHTML;sendNotification(element2.getElementsByClassName("sc-text-largevalue").item(0).innerHTML,element2.getElementsByClassName("scFieldLabel").item(0).innerHTML)}})),debug&&console.info("**Publish Done**")})),element2=document.getElementById("LastPage");element2&&(debug&&console.info("**Open dialog**"),_addEnvironmentLabel(),elementObserver2.observe(element2,{attributes:!0}));