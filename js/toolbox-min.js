import*as e from"./modules/global.js";import{preferesColorScheme as t,sitecoreItemJson as r,fetchTimeout as o,getScItemData as a,repositionElement as n,startDrag as i}from"./modules/helpers.js";import{showSnackbar as s}from"./modules/snackbar.js";import{checkWorkbox as c}from"./modules/workbox.js";import{checkUrlStatus as d}from"./modules/url.js";import{sendNotification as l}from"./modules/notification.js";import{cleanCountryName as u}from"./modules/language.js";import{sitecoreAuthorToolbox as g}from"./modules/contenteditor.js";if(e.debug&&console.info("%c "+window.location.href.replace("https://","").replace("http://",""),"font-size:10px; background: #32ed74; color: black; border-radius:5px; padding 3px;"),e.isSitecore&&!e.isEditMode&&!e.isLoginPage&&!e.isCss&&!e.isUploadManager){e.debug&&console.info("%c ✏️ Sitecore detected ","font-size:14px; background: #f33d35; color: white; border-radius:5px; padding 3px;"),e.debug&&console.info("%c *** Loading *** ","font-size:14px; background: #ffce42; color: black; border-radius:5px; padding 3px;");var m=document.createElement("script");m.src=chrome.runtime.getURL("js/inject-min.js"),(document.head||document.documentElement).appendChild(m),m.remove();var f=document.createElement("link");if(f.type="text/css",f.rel="stylesheet",f.href=chrome.runtime.getURL("css/onload-min.css"),document.getElementsByTagName("head")[0].appendChild(f),!e.isRichTextEditor&&document.querySelector("body").insertAdjacentHTML("beforeend",'<input type="hidden" class="extensionId" value="'+e.extensionId+'" />'),"granted"===Notification.permission||Notification.requestPermission().then((function(e){"granted"===e||console.info("User blocked notifications.")})).catch((function(e){console.info(e)})),(e.isContentEditor||e.isLaunchpad)&&(e.debug&&console.info("%c **** Content Editor / Launchpage **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),window.onpopstate=function(e){if(e.state&&""!=e.state.id){localStorage.setItem("scBackPrevious",!0);var t='scForm.invoke("item:load(id='+e.state.id+',language=,version=1)");';(m=document.createElement("script")).textContent=t,(document.head||document.documentElement).appendChild(m),m.remove()}},chrome.storage.sync.get(["feature_darkmode","feature_darkmode_auto"],(function(r){if(r.feature_darkmode&&r.feature_darkmode_auto){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{e.debug&&console.info("%c **** "+t()+" mode ON **** ","font-size:14px; background: #333333; color: white; border-radius:5px; padding 3px;");(m=document.createElement("script")).textContent="scForm.invoke('contenteditor:save', event)",(document.head||document.documentElement).appendChild(m),m.remove(),setTimeout((function(){window.location.reload()}),500)})}})),e.hasRedirection||e.hasRedirectionOther||e.isLaunchpad||chrome.storage.sync.get(["scData","feature_reloadnode"],(function(t){if(null==t.feature_reloadnode&&(t.feature_reloadnode=!0),null!=t.scData){if(""!=e.scUrlHash)t.scItemID=e.scUrlHash,t.scVersion=1,t.scLanguage="",t.scSource="Hash";else{var r=t.scData;for(var o in r)r.hasOwnProperty(o)&&o==window.location.origin&&(t.scItemID=r[o].scItemID,t.scLanguage=r[o].scLanguage,t.scVersion=r[o].scVersion,t.scSource="Storage")}if(t.scItemID&&1==t.feature_reloadnode){e.debug&&console.info("%c [Read "+t.scSource+"] Item : "+t.scItemID+" ","font-size:12px; background: #cdc4ba; color: black; border-radius:5px; padding 3px;"),e.debug&&console.info("%c [Read "+t.scSource+"] Language : "+t.scLanguage+" ","font-size:12px; background: #cdc4ba; color: black; border-radius:5px; padding 3px;"),e.debug&&console.info("%c [Read "+t.scSource+"] Version : "+t.scVersion+" ","font-size:12px; background: #cdc4ba; color: black; border-radius:5px; padding 3px;"),e.debug&&console.info("%c *** Redirection *** ","font-size:14px; background: #ffce42; color: black; border-radius:5px; padding 3px;");var a='scForm.invoke("item:load(id='+t.scItemID+",language="+t.scLanguage+",version="+t.scVersion+')");';(m=document.createElement("script")).textContent=a,(document.head||document.documentElement).appendChild(m),m.remove()}else g()}else g()})),chrome.storage.sync.get(["feature_favorites"],(function(t){if(null==t.feature_favorites&&(t.feature_favorites=!0),t.feature_favorites&&!e.isPublishWindow&&e.scContentTree){var r=document.querySelector("#sitecorAuthorToolboxFav");r&&r.remove();var o='<iframe id="sitecorAuthorToolboxFav" class="sitecorAuthorToolboxFav" src="'+("../default.aspx?xmlcontrol=Gallery.Favorites&id="+v+"&la=en&vs=1")+'" style="width:100%; height:150px; margin-top: 0px; resize: vertical;"></iframe>';e.scContentTree.insertAdjacentHTML("afterend",o)}})),e.isLaunchpad||chrome.storage.sync.get(["hideSnackbar"],(function(t){let r=e.extensionVersion;chrome.runtime.error||t.hideSnackbar==r||s(r)})),chrome.storage.sync.get(["feature_workbox"],(function(e){null==e.feature_workbox&&(e.feature_workbox=!0),chrome.runtime.error||1!=e.feature_workbox||c()}))),chrome.storage.sync.get(["feature_darkmode","feature_darkmode_auto"],(function(r){null==r.feature_darkmode&&(r.feature_darkmode=!1),null==r.feature_darkmode_auto&&(r.feature_darkmode_auto=!1);var o=t();if(r.feature_darkmode&&!r.feature_darkmode_auto&&!e.isTelerikUi&&!e.isExperienceEditor&&!e.isAdminCache&&!e.isSecurityWindow&&!e.isContentHome&&!e.isLoginPage&&!e.isEditMode&&!e.isUserManager&&!e.isRules&&!e.isAdmin||r.feature_darkmode&&r.feature_darkmode_auto&&!e.isTelerikUi&&!e.isExperienceEditor&&!e.isAdminCache&&!e.isSecurityWindow&&!e.isContentHome&&!e.isLoginPage&&!e.isEditMode&&!e.isUserManager&&!e.isRules&&!e.isAdmin&&"dark"==o){var a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/dark/default-min.css"),document.getElementsByTagName("head")[0].appendChild(a),(a=document.createElement("link")).type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/dark/ribbon-min.css"),document.getElementsByTagName("head")[0].appendChild(a),(a=document.createElement("link")).type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/dark/contentmanager-min.css"),document.getElementsByTagName("head")[0].appendChild(a),(a=document.createElement("link")).type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/dark/dialogs-min.css"),document.getElementsByTagName("head")[0].appendChild(a),(a=document.createElement("link")).type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/dark/gallery-min.css"),document.getElementsByTagName("head")[0].appendChild(a),(a=document.createElement("link")).type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/dark/speak-min.css"),document.getElementsByTagName("head")[0].appendChild(a)}})),e.isDesktop&&!e.isGalleryFavorites?(e.debug&&console.info("%c **** Desktop Shell **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_launchpad"],(function(t){if(null==t.feature_launchpad&&(t.feature_launchpad=!0),t.feature_launchpad){var r='<a href="#" class="scStartMenuLeftOption" title="" onclick="window.location.href=\''+e.launchpadPage+"?launchpad=true&url="+e.windowLocationHref+'\'"><img src="'+e.launchpadIcon+'" class="scStartMenuLeftOptionIcon" alt="" border="0"><div class="scStartMenuLeftOptionDescription"><div class="scStartMenuLeftOptionDisplayName">'+e.launchpadGroupTitle+'</div><div class="scStartMenuLeftOptionTooltip">'+e.launchpadTitle+"</div></div></a>",o=document.querySelectorAll(".scStartMenuLeftOption");for(let e of o)"Install and maintain apps."==e.getAttribute("title")&&e.insertAdjacentHTML("afterend",r)}}))):e.isLaunchpad?(e.debug&&console.info("%c **** Launchpad **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_launchpad"],(function(t){if(null==t.feature_launchpad&&(t.feature_launchpad=!0),t.feature_launchpad){var r=document.querySelectorAll(".last"),o='<div class="sc-launchpad-group"><header class="sc-launchpad-group-title">'+e.launchpadGroupTitle+'</header><div class="sc-launchpad-group-row"><a href="#" onclick="window.location.href=\''+e.launchpadPage+"?launchpad=true&url="+e.windowLocationHref+'\'" class="sc-launchpad-item" title="'+e.launchpadTitle+'"><span class="icon"><img src="'+e.launchpadIcon+'" width="48" height="48" alt="'+e.launchpadTitle+'"></span><span class="sc-launchpad-text">'+e.launchpadTitle+"</span></a></div></div>";r[0].insertAdjacentHTML("afterend",o)}}))):e.isAdminCache&&e.debug&&console.info("%c **** Admin Cache **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),e.isGalleryFavorites)e.debug&&console.info("%c **** Favorites **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;");else if(e.isModalDialogs)e.debug&&console.info("%c **** Jquery Modal **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;");else if(e.isSearch){e.debug&&console.info("%c **** Internal Search **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;");var p=document.querySelector("#results");y=new MutationObserver((function(e){var t=document.querySelector("#results").querySelectorAll(".BlogPostArea");for(var r of t){var o=r.querySelector(".BlogPostFooter"),a=r.querySelector(".BlogPostViews > a > img").getAttribute("title");(a=(a=a.split(" - "))[1].toLowerCase()).includes("/home/")&&(a="/"+(a=a.split("/home/"))[1]);var n='<div class="BlogPostExtra BlogPostContent" style="padding: 5px 0 0px 78px; color: #0769d6"><strong>Sitecore path:</strong> '+a+" <strong>Languages available:</strong> "+r.querySelector(".BlogPostHeader > span").getAttribute("title")+"</div>";a&&o.insertAdjacentHTML("afterend",n)}})),p&&(S={attributes:!1,childList:!0,characterData:!1,subtree:!1},y.observe(p,S))}else if(e.isFieldEditor){e.debug&&console.info("%c **** Field editor Search **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_charscount"],(function(t){if(null==t.feature_charscount&&(t.feature_charscount=!0),t.feature_charscount){var r,o,a=document.querySelectorAll("input, textarea"),n=0;for(var i of a)"scContentControl"!=i.className&&"scContentControlMemo"!=i.className||(i.setAttribute("style","padding-right: 70px !important"),i.parentElement.setAttribute("style","position:relative !important"),n=i.value.length,o=n>1?n+" chars":n+" char",r='<div id="chars_'+i.id+'" style="position: absolute; bottom: 1px; right: 1px; padding: 6px 10px; border-radius: 4px; line-height: 20px; opacity:0.5;">'+o+"</div>",i.insertAdjacentHTML("afterend",r));document.addEventListener("keyup",(function(t){"input"!=t.target.localName&&"textarea"!=t.target.localName||(n=t.target.value.length,o=n>1?n+" chars":n+" char",e.debug&&console.log("chars_"+t.target.id+" -> "+o),document.querySelector("#chars_"+t.target.id)&&(document.querySelector("#chars_"+t.target.id).innerText=o))}),!1)}}));var h=document.querySelectorAll(".scBucketListSelectedBox, .scContentControlMultilistBox"),b=document.querySelector("#Section_Data");(h=h[1]?h[1]:h[0])&&h.addEventListener("change",(function(){var t=h.value,r=h[h.selectedIndex].text,o='<a class="scMessageBarOption" href="'+window.location.origin+"/sitecore/shell/Applications/Content%20Editor.aspx#"+t+'" target="_blank"><u>Click here ⧉</u></a> ',a='<a class="scMessageBarOption" href="'+window.location.origin+"/?sc_mode=edit&sc_itemid="+t+'" target="_blank"><u>Click here ⧉</u></a> ',n='<div id="Warnings" class="scMessageBar scWarning"><div class="scMessageBarIcon" style="background-image:url('+e.icon+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">'+r+'</div><span id="Information" class="scMessageBarText"><span class="scMessageBarOptionBullet">'+o+'</span> to edit this item in <b>Content Editor</b>.</span><span id="Information" class="scMessageBarText"><br /><span class="scMessageBarOptionBulletXP">'+a+"</span> to edit this page in <b>Experience Editor</b>.</span></div></div>";document.querySelector(".scMessageBar")?(document.querySelector(".scMessageBarTitle").innerHTML=r,document.querySelector(".scMessageBarOptionBullet").innerHTML=o,document.querySelector(".scMessageBarOptionBulletXP").innerHTML=a):b.insertAdjacentHTML("beforebegin",n)})),chrome.storage.sync.get(["feature_errors"],(function(t){null==t.feature_errors&&(t.feature_errors=!0);var r=0,o=document.getElementsByClassName("scValidationMarkerIcon"),a=document.querySelector("#MainPanel");if(t.feature_errors){var n='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+e.icon+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let e of o)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=e.getAttribute("src")&&(n+='<li class="scMessageBarOptionBullet" onclick="'+e.getAttribute("onclick")+'" style="cursor:pointer;">'+e.getAttribute("title")+"</li>",r++);n+="</ul></div></div>",r>0&&a.insertAdjacentHTML("beforebegin",n);var i=document.querySelector(".scValidatorPanel"),s=new MutationObserver((function(t){r=0;var n='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+e.iconError+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let e of o)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=e.getAttribute("src")&&(n+='<li class="scMessageBarOptionBullet" onclick="'+e.getAttribute("onclick")+'" style="cursor:pointer;">'+e.getAttribute("title")+"</li>",r++);if(n+="</ul></div></div>",r>0)a.insertAdjacentHTML("beforebegin",n);else{var i=document.getElementById("scMessageBarError");i&&i.parentNode.removeChild(i)}e.debug&&console.log("!! Change !!")}));if(i){s.observe(i,{attributes:!0,childList:!0,characterData:!0})}}}))}else e.isMediaFolder?(e.debug&&console.info("%c **** Media Folder **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_dragdrop"],(function(t){if(null==t.feature_dragdrop&&(t.feature_dragdrop=!0),t.feature_dragdrop){var r=window.location.href.split("id=%7B"),o=(r=(r=r[1].split("%7B"))[0].split("%7D"))[0],a="/sitecore/client/Applications/Dialogs/UploadMediaDialog?ref=list&ro=sitecore://master/%7b"+o+"%7d%3flang%3den&fo=sitecore://master/%7b"+o+"%7d",n=document.querySelector(".scFolderButtons"),i='<a href="#" class="scButton" onclick="javascript:scSitecore.prototype.showModalDialog(\''+a+"', '', '', null, null); false\"><img src=\" "+e.launchpadIcon+' " width="16" height="16" class="scIcon" alt="" border="0"><div class="scHeader">Upload files (Drag and Drop)</div></a>';n.insertAdjacentHTML("afterbegin",i)}}))):e.isRichTextEditor||e.isHtmlEditor?(e.debug&&console.info("%c **** Rich text editor **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_rtecolor","feature_darkmode","feature_darkmode_auto"],(function(r){if(null==r.feature_rtecolor&&(r.feature_rtecolor=!0),null==r.feature_darkmode&&(r.feature_darkmode=!1),null==r.feature_darkmode_auto&&(r.feature_darkmode_auto=!1),r.feature_rtecolor){var o,a="default";if(e.isRichTextEditor?o=document.querySelector("#Editor_contentIframe"):e.isHtmlEditor&&(o=document.querySelector("#ctl00_ctl00_ctl05_Html")),o){if(e.isRichTextEditor){document.querySelector("#Editor_contentIframe").contentWindow.document.body,document.querySelector("#EditorContentHiddenTextarea");var n=document.querySelector(".reTextArea")}(f=document.createElement("link")).type="text/css",f.rel="stylesheet",f.href=chrome.runtime.getURL("css/codemirror.css"),document.getElementsByTagName("head")[0].appendChild(f);var i=t();(r.feature_darkmode&&!r.feature_darkmode_auto||r.feature_darkmode&&r.feature_darkmode_auto&&"dark"==i)&&(a="ayu-dark",(f=document.createElement("link")).type="text/css",f.rel="stylesheet",f.href=chrome.runtime.getURL("css/dark/ayu-dark.css"),document.getElementsByTagName("head")[0].appendChild(f)),e.isRichTextEditor?(n.insertAdjacentHTML("afterend",'<input type="hidden" class="scDarkMode" value="'+a+'" />'),n.insertAdjacentHTML("afterend",'<input type="hidden" class="scEditor" value="richTextEditor" />')):e.isHtmlEditor&&(o.insertAdjacentHTML("afterend",'<input type="hidden" class="scDarkMode" value="'+a+'" />'),o.insertAdjacentHTML("afterend",'<input type="hidden" class="scEditor" value="htmlEditor" />')),(m=document.createElement("script")).src=chrome.runtime.getURL("js/bundle-min.js"),(document.head||document.documentElement).appendChild(m),m.remove()}}}))):e.isGalleryLanguage?(e.debug&&console.info("%c **** Languages menu **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_flags"],(function(t){if(null==t.feature_flags&&(t.feature_flags=!0),t.feature_flags){var r,o,a,n,i=document.querySelector("#Languages"),s=i.querySelectorAll(".scMenuPanelItem,.scMenuPanelItemSelected"),c=0;(s=[].slice.call(s).sort((function(e,t){return e.querySelector("table > tbody > tr > td > div > div:last-child").textContent>t.querySelector("table > tbody > tr > td > div > div:last-child").textContent?-1:1}))).forEach((function(e){i.appendChild(e)}));for(let t of s){c=0,r=t.getElementsByTagName("td");for(let t of r){if(0==c)a=t.getElementsByTagName("img");else{if(o=(o=t.getElementsByTagName("b"))[0].innerHTML,"0"!=t.getElementsByTagName("div")[2].innerHTML.split(" ")[0]&&t.getElementsByTagName("div")[2].setAttribute("style","background-color: yellow; display: initial; padding: 0px 3px; color: #000000 !important"),o.includes("(region)"))for(n in o=o.split(" (region"),e.jsonData)e.jsonData.hasOwnProperty(n)&&o[0].toUpperCase()==e.jsonData[n].language.toUpperCase()&&(o=e.jsonData[n].flag);else o=u(o);o=o.toLowerCase(),a[0].onerror=function(){this.src=chrome.runtime.getURL("images/Flags/32x32/flag_generic.png")},a[0].src=chrome.runtime.getURL("images/Flags/32x32/flag_"+o+".png")}c++}0}}}))):e.isPublishDialog?(e.debug&&console.info("%c **** Publishing Window **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_flags"],(function(t){null==t.feature_flags&&(t.feature_flags=!0),t.feature_flags&&(p=document.querySelector("body"),y=new MutationObserver((function(t){var r,o,a,n=document.querySelectorAll("div[data-sc-id=CheckBoxListLanguages] > table:last-child")[0];if(null!=n&&n.children[0].children.length>1)for(var i of n.children[0].children)for(var s of i.children){for(o in r=u(s.innerText.trim()),e.jsonData)e.jsonData.hasOwnProperty(o)&&r==e.jsonData[o].language.toUpperCase()&&(r=e.jsonData[o].flag);a=r.toLowerCase(),a=chrome.runtime.getURL("images/Flags/16x16/flag_"+a+".png"),null==s.querySelector("#scFlag")&&s.querySelector("label > span").insertAdjacentHTML("beforebegin",' <img id="scFlag" src="'+a+'" style="display: inline; vertical-align: middle; padding-right: 2px;" onerror="this.onerror=null;this.src=\'-/icon/Flags/16x16/flag_generic.png\';"/>')}})),p&&y.observe(p,{attributes:!1,childList:!0,characterData:!1,subtree:!0}))}))):e.isPublishWindow&&(e.debug&&console.info("%c **** Publish / Rebuild **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_flags"],(function(t){if(null==t.feature_flags&&(t.feature_flags=!0),t.feature_flags){var r,o,a,n,i=document.querySelector("#Languages").getElementsByTagName("label");for(let t of i){for(a in r=t.innerText,console.log(r),o=u(r),e.jsonData)e.jsonData.hasOwnProperty(a)&&o==e.jsonData[a].language.toUpperCase()&&(o=e.jsonData[a].flag);n=o.toLowerCase(),n=chrome.runtime.getURL("images/Flags/16x16/flag_"+n+".png"),t.insertAdjacentHTML("beforebegin",' <img id="scFlag" src="'+n+'" style="display: inline; vertical-align: middle; padding-right: 2px;" onerror="this.onerror=null;this.src=\'-/icon/Flags/16x16/flag_generic.png\';"/>')}}})));chrome.storage.sync.get(["feature_autoexpand"],(function(e){null==e.feature_autoexpand&&(e.feature_autoexpand=!0),e.feature_autoexpand&&(document.addEventListener("click",(function(e){if(null!=e.target.offsetParent&&e.target.offsetParent.matches(".scContentTreeNodeNormal")){document.querySelector("#EditorFrames").setAttribute("style","opacity:0.6"),document.querySelector(".scContentTreeContainer").setAttribute("style","opacity:0.6"),document.querySelector(".scEditorTabHeaderActive > span").innerText="Loading";setTimeout((function(){document.querySelector("#EditorFrames").setAttribute("style","opacity:1"),document.querySelector(".scContentTreeContainer").setAttribute("style","opacity:1")}),8e3)}if(!e.target.matches(".scContentTreeNodeGlyph"))return;let t=e.target.id;setTimeout((function(){if(document&&t){let e=document.querySelector("#"+t).nextSibling.nextSibling.nextSibling;if(e){let t=e.querySelectorAll(".scContentTreeNode");1==t.length&&t[0].querySelector(".scContentTreeNodeGlyph").click()}}}),200)}),!1),document.addEventListener("mousedown",(function(e){if(!e.target.matches(".glyph"))return;let t=e.target.id,r=e.target.src.includes("collapsed");setTimeout((function(){if(document&&t&&r){var e=document.querySelector("#"+t).closest("ul").nextSibling;if(e)e.querySelector(".glyph").click()}}),200)}),!1))})),p=document.querySelector("#LastPage"),y=new MutationObserver((function(t){chrome.storage.sync.get(["feature_notification"],(function(e){if(null==e.feature_notification&&(e.feature_notification=!0),e.feature_notification){var t=(p=document.querySelector("#LastPage")).querySelector(".sc-text-largevalue").innerHTML,r=p.querySelector(".scFieldLabel").innerHTML;"Result:"==r&&(r="Finished "+document.querySelector("#ResultText").value.split("Finished")[1]),l(t,r);var o=parent.parent.document.querySelector("body");d(o)}})),e.debug&&console.info("%c *** Publish/Rebuild Done *** ","font-size:14px; background: #ffce42; color: black; border-radius:5px; padding 3px;")})),p&&y.observe(p,{attributes:!0}),p=document.querySelector("#scLanguage");var y=new MutationObserver((function(t){e.debug&&console.info("%c *** Update UI *** ","font-size:14px; background: #ffce42; color: black; border-radius:5px; padding 3px;");var r=document.querySelector(".scEditorHeaderQuickInfoInput");if(r){var o=r.getAttribute("value"),a=(document.querySelector("#scLanguage").getAttribute("value").toLowerCase(),document.querySelectorAll(".scEditorQuickInfo")),n=(a[a.length-1],a.length),i=document.getElementsByClassName("scEditorHeaderTitle"),s=document.querySelectorAll(".scEditorHeaderQuickInfoInput"),c=s[s.length-2].getAttribute("value"),d=localStorage.getItem("scBackPrevious");if(!e.hasRedirection&&!e.hasRedirectionOther)if("true"!=d){var l={sitecore:!0,id:o};history.pushState(l,void 0,"#"+o)}else localStorage.removeItem("scBackPrevious");if(e.debug&&console.info("%c - Tabs opened: "+n+" ","font-size:12px; background: #7b3090; color: white; border-radius:5px; padding 3px;"),n>1&&!document.getElementById("showInContentTree"+n)){var u=window.location.href,m=(u=u.split("#"))[0]+"&reload#"+c;i[n-1].insertAdjacentHTML("afterend",'[<a id="showInContentTree'+n+'" href="" onclick="javascript:window.location.href=\''+m+"'; return false;\" />Show in content tree</a>]")}}t.forEach((function(e){"attributes"==e.type&&g()}))}));p&&y.observe(p,{attributes:!0})}if(e.isEditMode&&!e.isLoginPage||e.isPreviewMode&&!e.isLoginPage){e.debug&&console.info("%c 🎨 Experience Editor detected ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),(f=document.createElement("link")).type="text/css",f.rel="stylesheet",f.href=chrome.runtime.getURL("css/onload-min.css"),document.getElementsByTagName("head")[0].appendChild(f),(f=document.createElement("link")).type="text/css",f.rel="stylesheet",f.href=chrome.runtime.getURL("css/tooltip-min.css"),document.getElementsByTagName("head")[0].appendChild(f),(m=document.createElement("script")).src=chrome.runtime.getURL("js/inject-min.js"),(document.head||document.documentElement).appendChild(m),m.remove();var x=document.querySelector("[data-sc-itemid]");if(x){var v=decodeURI(x.getAttribute("data-sc-itemid"));r(v,"en",1)}if(e.isGalleryLanguageExpEd&&(e.debug&&console.info("%c **** Languages **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;"),chrome.storage.sync.get(["feature_flags"],(function(t){if(null==t.feature_flags&&(t.feature_flags=!0),t.feature_flags){var r,o,a,n,i=document.querySelector(".sc-gallery-content"),s=i.querySelectorAll(".sc-gallery-option-content,.sc-gallery-option-content-active");(s=[].slice.call(s).sort((function(e,t){return e.querySelector("div > div:last-child > span").textContent>t.querySelector("div > div:last-child > span").textContent?-1:1}))).forEach((function(e){i.appendChild(e)}));for(let t of s){for(n in r=t.closest(".sc-gallery-option-content,.sc-gallery-option-content-active"),o=t.querySelector(".sc-gallery-option-content-header > span").innerText,"0"!=(a=t.querySelector(".sc-gallery-option-content-description > span")).innerHTML.split(" ")[0]&&a.setAttribute("style","background-color: yellow; display: initial; padding: 0px 3px; color: #000000 !important"),o=u(o),e.jsonData)e.jsonData.hasOwnProperty(n)&&o==e.jsonData[n].language.toUpperCase()&&(o=e.jsonData[n].flag);r.setAttribute("style","padding-left:48px; background-image: url("+chrome.runtime.getURL("images/Flags/32x32/flag_"+o+".png")+"); background-repeat: no-repeat; background-position: 5px;")}}}))),e.isRibbon){e.debug&&console.info("%c **** Ribbon **** ","font-size:14px; background: #f16100; color: black; border-radius:5px; padding 3px;");var k,_,L=document.querySelector(".flag_generic_24");for(_ in k=L.nextSibling.innerText,k=u(k),e.jsonData)e.jsonData.hasOwnProperty(_)&&k==e.jsonData[_].language.toUpperCase()&&(k=e.jsonData[_].flag);L.setAttribute("style","background-image: url("+chrome.runtime.getURL("images/Flags/24x24/flag_"+k+".png")+"); background-repeat: no-repeat; background-position: top left;")}if(p=document.querySelector(".scChromeControls"),y=new MutationObserver((function(e){var t=document.querySelectorAll(".scChromeToolbar");for(var r of t){r.setAttribute("style","margin-left:50px");var o=r.querySelectorAll(".scChromeCommand");r.querySelector(".scChromeText"),r.querySelector(".scChromeCommandText");for(var a of o){var n=a.getAttribute("title");a.setAttribute("style","z-index:auto"),null!=n&&(a.setAttribute("data-tooltip",n),a.classList.add("t-bottom"),a.classList.add("t-sm"),a.removeAttribute("title"))}}})),p){var S={attributes:!0,childList:!0,characterData:!0};y.observe(p,S)}var E=t();chrome.storage.sync.get(["feature_darkmode","feature_darkmode_auto","feature_toggleribbon"],(function(t){var r=document.querySelector(".pagemode-edit");r||(r=document.querySelector(".on-page-editor")),r||(r=document.querySelector(".experience-editor")),r||(r=document.querySelector(".scWebEditRibbon"));e.windowLocationHref.includes("?"),document.querySelector("#scCrossPiece"),document.querySelector("#scWebEditRibbon"),document.querySelector(".sc-messageBar");let o;if(null==t.feature_darkmode&&(t.feature_darkmode=!1),null==t.feature_darkmode_auto&&(t.feature_darkmode_auto=!1),null==t.feature_toggleribbon&&(t.feature_toggleribbon=!0),t.feature_toggleribbon&&((a=document.createElement("link")).type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/reset-min.css"),document.getElementsByTagName("head")[0].appendChild(a)),t.feature_darkmode&&!t.feature_darkmode_auto&&e.isRibbon||t.feature_darkmode&&!t.feature_darkmode_auto&&e.isDialog||t.feature_darkmode&&!t.feature_darkmode_auto&&e.isInsertPage||t.feature_darkmode&&t.feature_darkmode_auto&&e.isRibbon&&"dark"==E||t.feature_darkmode&&t.feature_darkmode_auto&&e.isDialog&&"dark"==E||t.feature_darkmode&&t.feature_darkmode_auto&&e.isInsertPage&&"dark"==E){var a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=chrome.runtime.getURL("css/dark/experience-min.css"),document.getElementsByTagName("head")[0].appendChild(a)}(t.feature_darkmode&&!t.feature_darkmode_auto||t.feature_darkmode&&t.feature_darkmode_auto&&"dark"==E)&&(o="dark");var n,s=document.body,c=new MutationObserver((function(e){for(var t of e)for(var r of t.addedNodes)if("scCrossPiece"==r.id){var a='<div class="scExpTab '+o+'"><span class="tabHandle"></span><span class="tabText" onclick="toggleRibbon()">▲ Hide<span></div>';r.insertAdjacentHTML("afterend",a),c.disconnect(),i()}}));if(t.feature_toggleribbon&&s){c.observe(s,{attributes:!1,childList:!0,characterData:!1})}if(n=e.isEditMode?e.windowLocationHref.replace("sc_mode=edit","sc_mode=normal"):e.isPreviewMode?e.windowLocationHref.replace("sc_mode=preview","sc_mode=normal"):e.windowLocationHref.includes("?")?e.windowLocationHref+"&sc_mode=normal":e.windowLocationHref+"?sc_mode=normal",t.feature_toggleribbon&&!e.isRibbon){var d='<div class="scNormalModeTab '+o+'"><span class="t-right t-sm" data-tooltip="Open in Normal Mode"><a href="'+n+'"><img src="'+e.iconChrome+'"/></a></span></div>';r&&r.insertAdjacentHTML("afterend",d)}t.feature_toggleribbon&&!e.isRibbon&&(d='<div class="scContentEditorTab '+o+'"><span class="t-right t-sm" data-tooltip="Open in Content Editor"><a href="'+window.location.origin+'/sitecore/shell/Applications/Content%20Editor.aspx?sc_bw=1"><img src="'+e.iconCE+'"/></a></span></div>',r&&r.insertAdjacentHTML("afterend",d))}))}