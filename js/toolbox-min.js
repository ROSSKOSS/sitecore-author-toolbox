var debug=!1,feature_urls=!0,feature_flags=!0,feature_errors=!0,feature_dragdrop=!0,feature_notification=!0,feature_darkmode=!1;function stripHtml(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}function sendNotification(e,t){new Notification(e,{body:t,icon:chrome.runtime.getURL("images/icon.png")})}if(chrome.storage.sync.get(["debug"],(function(e){chrome.runtime.error||null==e.debug||(debug=e.debug)})),chrome.storage.sync.get(["feature_urls"],(function(e){chrome.runtime.error||null==e.feature_urls||(feature_urls=e.feature_urls)})),chrome.storage.sync.get(["feature_flags"],(function(e){chrome.runtime.error||null==e.feature_flags||(feature_flags=e.feature_flags)})),chrome.storage.sync.get(["feature_errors"],(function(e){chrome.runtime.error||null==e.feature_errors||(feature_errors=e.feature_errors)})),chrome.storage.sync.get(["feature_dragdrop"],(function(e){chrome.runtime.error||null==e.feature_dragdrop||(feature_dragdrop=e.feature_dragdrop)})),chrome.storage.sync.get(["feature_notification"],(function(e){chrome.runtime.error||null==e.feature_notification||(feature_notification=e.feature_notification)})),chrome.storage.sync.get(["feature_darkmode"],(function(e){chrome.runtime.error||null==e.feature_darkmode||(feature_darkmode=e.feature_darkmode)})),(feature_darkmode=!0)&&"/sitecore/login"!=window.location.pathname){console.log("start");var link=document.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=chrome.runtime.getURL("css/dark/default-min.css"),document.getElementsByTagName("head")[0].appendChild(link),(link=document.createElement("link")).type="text/css",link.rel="stylesheet",link.href=chrome.runtime.getURL("css/dark/ribbon-min.css"),document.getElementsByTagName("head")[0].appendChild(link),(link=document.createElement("link")).type="text/css",link.rel="stylesheet",link.href=chrome.runtime.getURL("css/dark/contentmanager-min.css"),document.getElementsByTagName("head")[0].appendChild(link),(link=document.createElement("link")).type="text/css",link.rel="stylesheet",link.href=chrome.runtime.getURL("css/dark/dialogs-min.css"),document.getElementsByTagName("head")[0].appendChild(link),(link=document.createElement("link")).type="text/css",link.rel="stylesheet",link.href=chrome.runtime.getURL("css/dark/gallery-min.css"),document.getElementsByTagName("head")[0].appendChild(link),console.log("end")}function _addEnvironmentLabel(){var e=0,t=chrome.runtime.getURL("images/rocket.png"),r=chrome.runtime.getURL("images/error.png"),n=chrome.runtime.getURL("images/edit.png"),s=chrome.runtime.getURL("images/flags/");let a=document.querySelector(".scEditorHeader");document.querySelector(".scEditorHeaderTitle");document.getElementsByClassName("scEditorQuickInfo");let i=document.querySelector(".scEditorHeaderQuickInfoInput"),o=document.querySelector(".scEditorHeaderVersionsLanguage"),l=document.querySelector(".scEditorTabHeaderActive");var c=document.getElementsByClassName("scValidationMarkerIcon");let d=document.querySelector("#EditorFrames");if(i){var u=document.getElementsByClassName("scEditorHeaderQuickInfoInput"),m=u[0].getAttribute("value"),g=u[1].getAttribute("value"),f=g,p=!1,v=(g=g.split("/Home/"))[0];v=(v=v.split("/")).slice(-1)[0],"Data"==(u=f.split("/"))[u.length-1]&&(p=!0);var h=document.getElementById("scLanguage").getAttribute("value").toLowerCase(),b=window.location.origin+"/?sc_itemid="+m+"&sc_mode=normal&sc_lang="+h+"&sc_site="+v,y=(u=document.getElementsByClassName("scEditorHeaderVersionsLanguage"))[0].getAttribute("title"),_=(stripHtml(u[0].innerHTML),(g=null!=g[1]?encodeURI(window.location.origin+"/"+h+"/"+g[1]+"?sc_site="+v+"&sc_mode=normal").toLowerCase():encodeURI(window.location.origin+"/"+h+"/?sc_site="+v).toLowerCase()).includes("/data/"));if(!p&&g!=encodeURI(window.location.origin+"/"+h+"/?sc_site="+v).toLowerCase()&&!_&&!document.getElementById("scMessageBarUrl")&&feature_urls){var k='<div id="scMessageBarUrl" class="scMessageBar scWarning"><div class="scMessageBarIcon" style="background-image:url('+t+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">Sitecore Live URL</div><div class="scMessageBarText">If you want to preview this page in <b>'+y+'</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+g+'" target="_blank" class="scMessageBarOption">Open this link</a> or try <a href="'+b+'" target="_blank" class="scMessageBarOption">this alternative link</a></li></ul></div></div>';a.insertAdjacentHTML("afterend",k)}_&&(g=g.split("/data/"),!document.getElementById("scMessageBarInfo")&&feature_urls&&(k='<div id="scMessageBarInfo" class="scMessageBar scInformation"><div class="scMessageBarIcon" style="background-image:url('+n+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">You are editing a data source...</div><div class="scMessageBarText">To see it, you need to add/edit it to your page via the</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+g[0]+'?sc_mode=edit" target="_blank" class="scMessageBarOption">Experience Editor</a> or <a href="" class="scMessageBarOption" onclick="javascript:return scForm.invoke(\'item:setlayoutdetails\', event)">Presentation details<a></li></ul></div></div>',a.insertAdjacentHTML("afterend",k))),!document.getElementById("scFlag")&&feature_flags&&l.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+s+h+'.png" style="width: 20px; vertical-align: middle; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+s+"missing.png';\" />"),feature_flags&&o.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+s+h+'.png" style="width: 15px; vertical-align: sub; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+s+"missing.png';\" />")}if(null!=c[0]&&feature_errors){var B='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+r+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let t of c)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=t.getAttribute("src")&&(B+='<li class="scMessageBarOptionBullet" onclick="'+t.getAttribute("onclick")+'" style="cursor:pointer;">'+t.getAttribute("title")+"</li>",e++);B+="</ul></div></div>",e>0&&a.insertAdjacentHTML("afterend",B)}var E=document.getElementById("EditorFrames");if(E){var M,L,x;E=E.getElementsByTagName("iframe"),e=0;for(let t of E)if(M=E[e].src,L=E[e],e++,x=M.includes("/Media/"))break;if(x&&feature_dragdrop)L.onload=function(){var e='<iframe id="sitecorAuthorToolbox" class="sitecorAuthorToolbox" src="'+("/sitecore/client/Applications/Dialogs/UploadMediaDialog?fo=sitecore://master/{"+(M=(M=M.split("id=%7B"))[1].split("%7B"))[0]+"}")+'" style="width:100%; height:500px; margin-top: -60px; resize: vertical;"></iframe>';L.setAttribute("style","margin-top: -60px;");var t=document.getElementById("sitecorAuthorToolbox");t&&(t.remove(),debug&&console.info("Remove iFrame from DOM")),d.insertAdjacentHTML("afterbegin",e)};else{var T=document.getElementById("sitecorAuthorToolbox");T&&(T.remove(),debug&&console.info("Remove iFrame from DOM (no folder)"))}}!0===debug&&(console.info("Media folder:"+x),console.info("Active language: "+h)),window.Notification?"granted"===Notification.permission||Notification.requestPermission().then((function(e){"granted"===e||console.info("User blocked notifications.")})).catch((function(e){console.error(e)})):console.info("Browser does not support notifications.")}var MutationObserver=window.MutationObserver,elementObserver=new MutationObserver((function(e){debug&&console.info("Change"),e.forEach((function(e){console.info(e),"attributes"==e.type&&_addEnvironmentLabel()}))})),element=document.getElementById("scLanguage");element&&(debug&&console.info("First load"),_addEnvironmentLabel(),elementObserver.observe(element,{attributes:!0}));var elementObserver2=new MutationObserver((function(e){if(e.forEach((function(e){"attributes"==e.type&&_addEnvironmentLabel()})),feature_notification){element2.getElementsByClassName("DialogHeader").item(0).innerHTML;sendNotification(element2.getElementsByClassName("sc-text-largevalue").item(0).innerHTML,element2.getElementsByClassName("scFieldLabel").item(0).innerHTML)}debug&&console.info("Publish Done")})),element2=document.getElementById("LastPage");element2&&(debug&&console.info("Open publish"),_addEnvironmentLabel(),elementObserver2.observe(element2,{attributes:!0}));