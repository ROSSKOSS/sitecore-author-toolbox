import*as e from"./modules/global.js";import*as t from"./modules/local.js";import{consoleLog as r,loadCssFile as a,loadJsFile as o,exeJsCode as i,preferesColorScheme as n,sitecoreItemJson as s,fetchTimeout as c,getScItemData as l,repositionElement as u,startDrag as d}from"./modules/helpers.js";import{showSnackbar as m}from"./modules/snackbar.js";import{checkWorkbox as g}from"./modules/workbox.js";import{checkUrlStatus as p}from"./modules/url.js";import{checkNotification as f,sendNotification as y}from"./modules/notification.js";import{cleanCountryName as h,findCountryName as v}from"./modules/language.js";import{sitecoreAuthorToolbox as b}from"./modules/contenteditor.js";import{getGravatar as _}from"./modules/users.js";import{instantSearch as S}from"./modules/instantsearch.js";import{insertModal as x,insertPanel as k}from"./modules/menu.js";import{insertSavebar as q,insertBreadcrumb as L,initInsertIcon as M,getAccentColor as T,initColorPicker as A,initSitecoreMenu as w}from"./modules/experimentalui.js";chrome.storage.sync.get(t=>{r(window.location.href.replace("https://","").replace("http://",""),"green");let c=n(),u=!1;if(e.isSitecore&&!e.isEditMode&&!e.isLoginPage&&!e.isCss&&!e.isUploadManager){
//!global.isRichTextEditor ? document.querySelector('body').insertAdjacentHTML( 'beforeend', '<input type="hidden" class="extensionId" value="' + global.extensionId + '" />' ) : false;
if(a("css/onload-min.css"),o("js/inject.js"),null==t.feature_darkmode&&(t.feature_darkmode=!1),null==t.feature_darkmode_auto&&(t.feature_darkmode_auto=!1),null==t.feature_experimentalui&&(t.feature_experimentalui=!1),(!t.feature_darkmode||t.feature_darkmode_auto||e.isTelerikUi||e.isExperienceEditor||e.isAdminCache||e.isContentHome||e.isLoginPage||e.isEditMode||e.isRules||e.isAdmin)&&(!t.feature_darkmode||!t.feature_darkmode_auto||e.isTelerikUi||e.isExperienceEditor||e.isAdminCache||e.isContentHome||e.isLoginPage||e.isEditMode||e.isRules||e.isAdmin||"dark"!=c)||(u=!0,a("css/dark/default-min.css"),a("css/dark/ribbon-min.css"),a("css/dark/contentmanager-min.css"),a("css/dark/dialogs-min.css"),a("css/dark/gallery-min.css"),a("css/dark/speak-min.css"),0==navigator.platform.indexOf("Win")&&a("css/dark/scrollbars-min.css")),f(),e.isContentEditor||e.isLaunchpad){if(r("**** Content Editor / Launchpage ****","yellow"),null==t.feature_experimentalui&&(t.feature_experimentalui=!1),!e.isLaunchpad&&t.feature_experimentalui){let r=l();a("css/experimentalui.css"),(!t.feature_darkmode||t.feature_darkmode_auto||e.isTelerikUi||e.isExperienceEditor||e.isAdminCache||e.isContentHome||e.isLoginPage||e.isEditMode||e.isRules||e.isAdmin)&&(!t.feature_darkmode||!t.feature_darkmode_auto||e.isTelerikUi||e.isExperienceEditor||e.isAdminCache||e.isContentHome||e.isLoginPage||e.isEditMode||e.isRules||e.isAdmin||"dark"!=c)||a("css/dark/experimentalui-min.css");let o=document.querySelector("#SearchPanel");o&&(o.innerHTML="Content"),q(),x(r.id,r.language,r.version),k(),M();let i=document.querySelector(".sc-accountInformation"),n=document.querySelector(".sc-globalHeader-startButton");if(i){let t="center:yes; help:no; resizable:yes; scroll:yes; status:no; dialogMinHeight:200; dialogMinWidth:300; dialogWidth:1100; dialogHeight:700; header:",r='<div class="sc-globalheader-appName">Content Editor</div>';n&&n.insertAdjacentHTML("afterend",r);let a='<img loading="lazy" title="No notification in your workbox" id="scNotificationBell" onclick="javascript:scSitecore.prototype.showModalDialog(\''+e.workboxPage.replace("&sc_bw=1","&sc_bw=0")+"', '', '"+t+'Workbox\', null, null); false" src="'+e.iconBell+'" class="scIconMenu" accesskey="w"/>\n                                    <img loading="lazy" title="Show ribbon" id="scSitecoreMenu" onclick="showSitecoreMenu()" src="'+e.iconDownArrow+'" class="scIconMenu" accesskey="a" />';i.insertAdjacentHTML("afterbegin",a),A(),w();i.querySelectorAll("li")[1].innerText;i.querySelector("li").remove(),i.querySelector("li").innerHTML=i.querySelector("li > img").outerHTML,i.querySelector("li > img").setAttribute("id","globalHeaderUserPortrait");let o="\n                    <ul class=\"scAccountMenu\">\n                        <li onclick=\"javascript:return scForm.invoke('preferences:changeuserinformation', event)\">My account (' + accountUser + ')</li>\n                        <li onclick=\"javascript:return scForm.invoke('security:changepasswor', event)\">Change Password</li>\n                        <li onclick=\"javascript:return scForm.invoke('shell:useroptions', event)\">Application Options</li>\n                        <li onclick=\"window.open('"+e.launchpadPage+"')\">Sitecore Author Toolbox Options</li>\n                        <li onclick=\"javascript:return scForm.invoke('preferences:changeregionalsettings', event)\">Region and Languages</li>\n                        <li onclick=\"javascript:return scForm.invoke('system:showlicenses', event)\">Licences</li>\n                        <li onclick=\"javascript:return scForm.invoke('system:showabout', event)\">Licence details</li>\n                        <li onclick=\"javascript:return scForm.invoke('contenteditor:close', event)\">Logout</li>\n                    </ul>";i.insertAdjacentHTML("afterbegin",o)}document.addEventListener("click",e=>{let t=document.querySelector("#EditorTabs").getBoundingClientRect().bottom;document.querySelector(".scAccountMenu")&&("globalHeaderUserPortrait"==e.srcElement.id?document.querySelector(".scAccountMenu").setAttribute("style","visibility: visible; top: 50px; opacity: 1;"):document.querySelector(".scAccountMenu").setAttribute("style","visibility: hidden; top: 40px; opacity: 0;")),document.querySelector(".scPublishMenu")&&("scPublishMenuMore"==e.srcElement.id?document.querySelector(".scPublishMenu").setAttribute("style","visibility: visible; opacity: 1;"):document.querySelector(".scPublishMenu").setAttribute("style","visibility: hidden; opacity: 0;")),document.querySelector("#scPanel")&&("scMoreButton"==e.srcElement.id||"scMoreButton"==e.path[1].id||"scPanel"==e.srcElement.id||"content"==e.path[0].className?document.querySelector("#scPanel").setAttribute("style","right: 0 !important; top: "+t+"px !important"):document.querySelector("#scPanel").setAttribute("style","right: -420px !important; top: "+t+"px !important")),document.querySelector("#scLanguageIframe")&&("scLanguageButton"==e.srcElement.id||"scLanguageButton"==e.path[1].id?document.querySelector("#scLanguageIframe").setAttribute("style","right: 0 !important; top: "+t+"px !important"):document.querySelector("#scLanguageIframe").setAttribute("style","right: -420px !important; top: "+t+"px !important")),document.querySelector("#scVersionIframe")&&("scVersionButton"==e.srcElement.id||"scVersionButton"==e.path[1].id?document.querySelector("#scVersionIframe").setAttribute("style","right: 0 !important; top: "+t+"px !important"):document.querySelector("#scVersionIframe").setAttribute("style","right: -420px !important; top: "+t+"px !important")),document.querySelector(".scPublishMenu"),document.querySelector("#scModal")&&("scOverlay"==e.srcElement.className&&document.querySelector(".scOverlay").setAttribute("style","visibility: hidden"),"scOverlay"==e.srcElement.className&&document.querySelector("#scModal").setAttribute("style","opacity:0; visibility: hidden; top: calc(50% - 550px/2 - 10px)"))})}if(null==t.feature_instantsearch&&(t.feature_instantsearch=!0),!e.isLaunchpad&&t.feature_instantsearch){let e=document.querySelector(".sc-globalHeader"),t='<input type="text" class="scInstantSearch scIgnoreModified" placeholder="Search for content or media" tabindex="1" accesskey="f">',r='<ul class="scInstantSearchResults"></ul>';e&&e.insertAdjacentHTML("afterbegin",r),e&&e.insertAdjacentHTML("afterbegin",t),e&&S()}if(window.onpopstate=function(e){e.state&&""!=e.state.id&&(localStorage.setItem("scBackPrevious",!0),i('scForm.invoke("item:load(id='+e.state.id+",language="+e.state.language+",version="+e.state.version+')");'))},t.feature_darkmode&&t.feature_darkmode_auto){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{i("scForm.invoke('contenteditor:save', event)"),setTimeout((function(){window.location.reload()}),500)})}if(!e.hasRedirection&&!e.hasRedirectionOther&&!e.isLaunchpad)if(null==t.feature_reloadnode&&(t.feature_reloadnode=!0),null!=t.scData){if(""!=e.scUrlHash)se=e.scUrlHash.split("_"),t.scItemID=se[0],t.scLanguage=se[1],t.scVersion=se[2],t.scSource="Hash";else{var L=t.scData;for(var E in L)L.hasOwnProperty(E)&&E==window.location.origin&&(t.scItemID=L[E].scItemID,t.scLanguage=L[E].scLanguage,t.scVersion=L[E].scVersion,t.scSource="Storage")}null==t.scLanguage&&(t.scLanguage="en"),t.scItemID&&1==t.feature_reloadnode&&(r("[Read "+t.scSource+"] Item : "+t.scItemID,"beige"),r("[Read "+t.scSource+"] Language : "+t.scLanguage,"beige"),r("[Read "+t.scSource+"] Version : "+t.scVersion,"beige"),r("*** Redirection ***","yellow"),i('scForm.invoke("item:load(id='+t.scItemID+",language="+t.scLanguage+",version="+t.scVersion+')");')),b()}else b();if(null==t.feature_favorites&&(t.feature_favorites=!0),t.feature_favorites&&!e.isPublishWindow&&e.scContentTree){var C=document.querySelector("#sitecorAuthorToolboxFav");C&&C.remove();var B='<iframe loading="lazy" id="sitecorAuthorToolboxFav" class="sitecorAuthorToolboxFav" src="'+("../default.aspx?xmlcontrol=Gallery.Favorites&id="+l().id+"&la=en&vs=1")+'" style="width:100%; height:150px; margin-top: 0px; resize: vertical;"></iframe>';e.scContentTree.insertAdjacentHTML("afterend",B)}if(!e.isLaunchpad){let t=e.extensionVersion;localStorage.getItem("sbDismiss")!=t&&m(t)}null==t.feature_workbox&&(t.feature_workbox=!0),!chrome.runtime.error&&1==t.feature_workbox&&g()}if(e.isDesktop&&!e.isGalleryFavorites&&(r("**** Desktop Shell ****","orange"),null==t.feature_launchpad&&(t.feature_launchpad=!0),t.feature_launchpad)){var H='<a href="#" class="scStartMenuLeftOption" title="" onclick="window.location.href=\''+e.launchpadPage+"?launchpad=true&url="+e.windowLocationHref+'\'"><img loading="lazy" src="'+e.launchpadIcon+'" class="scStartMenuLeftOptionIcon" alt="" border="0"><div class="scStartMenuLeftOptionDescription"><div class="scStartMenuLeftOptionDisplayName">'+e.launchpadGroupTitle+'</div><div class="scStartMenuLeftOptionTooltip">'+e.launchpadTitle+"</div></div></a>",I=document.querySelectorAll(".scStartMenuLeftOption");for(let e of I)"Install and maintain apps."==e.getAttribute("title")&&e.insertAdjacentHTML("afterend",H)}if(e.isLaunchpad&&(r("**** Launchpad ****","orange"),null==t.feature_launchpad&&(t.feature_launchpad=!0),t.feature_launchpad)){var P=document.querySelectorAll(".last");H='<div class="sc-launchpad-group"><header class="sc-launchpad-group-title">'+e.launchpadGroupTitle+'</header><div class="sc-launchpad-group-row"><a href="#" onclick="window.location.href=\''+e.launchpadPage+"?launchpad=true&url="+e.windowLocationHref+'\'" class="sc-launchpad-item" title="'+e.launchpadTitle+'"><span class="icon"><img loading="lazy" src="'+e.launchpadIcon+'" width="48" height="48" alt="'+e.launchpadTitle+'"></span><span class="sc-launchpad-text">'+e.launchpadTitle+"</span></a></div></div>",P[0].insertAdjacentHTML("afterend",H)}if(e.isSearch){r("**** Internal Search ****","orange");var j=document.querySelector("#results"),F=new MutationObserver((function(e){var t=document.querySelector("#results").querySelectorAll(".BlogPostArea");for(var r of t){var a=r.querySelector(".BlogPostFooter"),o=r.querySelector(".BlogPostViews > a > img").getAttribute("title");(o=(o=o.split(" - "))[1].toLowerCase()).includes("/home/")&&(o="/"+(o=o.split("/home/"))[1]);var i='<div class="BlogPostExtra BlogPostContent" style="padding: 5px 0 0px 78px; color: #0769d6"><strong>Sitecore path:</strong> '+o+" <strong>Languages available:</strong> "+r.querySelector(".BlogPostHeader > span").getAttribute("title")+"</div>";o&&a.insertAdjacentHTML("afterend",i)}}));j&&F.observe(j,{attributes:!1,childList:!0,characterData:!1,subtree:!1})}if(e.isFieldEditor){if(r("**** Field editor ****","orange"),null==t.feature_charscount&&(t.feature_charscount=!0),t.feature_charscount){var R,D,O=document.querySelectorAll("input, textarea"),N=0;for(var U of O)"scContentControl"!=U.className&&"scContentControlMemo"!=U.className||(U.setAttribute("style","padding-right: 70px !important"),U.parentElement.setAttribute("style","position:relative !important"),N=U.value.length,D=N>1?N+" chars":N+" char",R='<div id="chars_'+U.id+'" style="position: absolute; bottom: 1px; right: 1px; padding: 6px 10px; border-radius: 4px; line-height: 20px; opacity:0.5;">'+D+"</div>",U.insertAdjacentHTML("afterend",R));document.addEventListener("keyup",(function(e){"input"!=e.target.localName&&"textarea"!=e.target.localName||(N=e.target.value.length,D=N>1?N+" chars":N+" char",document.querySelector("#chars_"+e.target.id)&&(document.querySelector("#chars_"+e.target.id).innerText=D))}),!1)}var V=document.querySelectorAll(".scBucketListSelectedBox, .scContentControlMultilistBox"),z=document.querySelector("#Section_Data");(V=V[1]?V[1]:V[0])&&V.addEventListener("change",(function(){var t=V.value,r=V[V.selectedIndex].text,a='<a class="scMessageBarOption" href="'+window.location.origin+"/sitecore/shell/Applications/Content%20Editor.aspx#"+t+'" target="_blank"><u>Click here ⧉</u></a> ',o='<a class="scMessageBarOption" href="'+window.location.origin+"/?sc_mode=edit&sc_itemid="+t+'" target="_blank"><u>Click here ⧉</u></a> ',i='<div id="Warnings" class="scMessageBar scWarning"><div class="scMessageBarIcon" style="background-image:url('+e.icon+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">'+r+'</div><span id="Information" class="scMessageBarText"><span class="scMessageBarOptionBullet">'+a+'</span> to edit this item in <b>Content Editor</b>.</span><span id="Information" class="scMessageBarText"><br /><span class="scMessageBarOptionBulletXP">'+o+"</span> to edit this page in <b>Experience Editor</b>.</span></div></div>";document.querySelector(".scMessageBar")?(document.querySelector(".scMessageBarTitle").innerHTML=r,document.querySelector(".scMessageBarOptionBullet").innerHTML=a,document.querySelector(".scMessageBarOptionBulletXP").innerHTML=o):z.insertAdjacentHTML("beforebegin",i)})),null==t.feature_errors&&(t.feature_errors=!0);var G=0,W=document.getElementsByClassName("scValidationMarkerIcon"),Q=document.querySelector("#MainPanel");if(t.feature_errors){var X='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+e.icon+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let e of W)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=e.getAttribute("src")&&(X+='<li class="scMessageBarOptionBullet" onclick="'+e.getAttribute("onclick")+'" style="cursor:pointer;">'+e.getAttribute("title")+"</li>",G++);X+="</ul></div></div>",G>0&&Q.insertAdjacentHTML("beforebegin",X),j=document.querySelector(".scValidatorPanel"),F=new MutationObserver((function(t){G=0;var r='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+e.iconError+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let e of W)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=e.getAttribute("src")&&(r+='<li class="scMessageBarOptionBullet" onclick="'+e.getAttribute("onclick")+'" style="cursor:pointer;">'+e.getAttribute("title")+"</li>",G++);if(r+="</ul></div></div>",G>0)Q.insertAdjacentHTML("beforebegin",r);else{var a=document.getElementById("scMessageBarError");a&&a.parentNode.removeChild(a)}})),j&&F.observe(j,{attributes:!0,childList:!0,characterData:!0})}}if(e.isMediaFolder&&(r("**** Media Folder ****","orange"),null==t.feature_dragdrop&&(t.feature_dragdrop=!0),t.feature_dragdrop)){var J=window.location.href.split("id=%7B"),K=(J=(J=J[1].split("%7B"))[0].split("%7D"))[0],Y="/sitecore/client/Applications/Dialogs/UploadMediaDialog?ref=list&ro=sitecore://master/%7b"+K+"%7d%3flang%3den&fo=sitecore://master/%7b"+K+"%7d",Z=document.querySelector(".scFolderButtons"),$='<a href="#" class="scButton" onclick="javascript:scSitecore.prototype.showModalDialog(\''+Y+"', '', '', null, null); false\"><img loading=\"lazy\" src=\" "+e.launchpadIcon+' " width="16" height="16" class="scIcon" alt="" border="0"><div class="scHeader">Upload files (Drag and Drop)</div></a>';Z.insertAdjacentHTML("afterbegin",$)}if(e.isExperienceProfile&&(r("**** Experience Profile ****","orange"),null==t.feature_gravatarimage&&(t.feature_gravatarimage=!0),t.feature_gravatarimage&&(j=document.querySelector("body"),F=new MutationObserver((function(e){let t=document.querySelector("img[data-sc-id=InfoPhotoImage]"),r=document.querySelector("a[data-sc-id=InfoEmailLink]");t&&r&&r.innerHTML.includes("@")&&!t.src.includes("www.gravatar.com")&&(t.src=_(r.innerHTML,170),F.disconnect())})),j&&F.observe(j,{attributes:!1,childList:!0,characterData:!0,subtree:!0}))),(e.isRichTextEditor||e.isHtmlEditor)&&(r("**** Rich Text Editor ****","orange"),null==t.feature_rtecolor&&(t.feature_rtecolor=!0),null==t.feature_darkmode&&(t.feature_darkmode=!1),null==t.feature_darkmode_auto&&(t.feature_darkmode_auto=!1),t.feature_rtecolor)){var ee,te="default";if(e.isRichTextEditor?ee=document.querySelector("#Editor_contentIframe"):e.isHtmlEditor&&(ee=document.querySelector("#ctl00_ctl00_ctl05_Html")),ee){if(e.isRichTextEditor){document.querySelector("#Editor_contentIframe").contentWindow.document.body,document.querySelector("#EditorContentHiddenTextarea");var re=document.querySelector(".reTextArea")}a("css/codemirror.css"),(t.feature_darkmode&&!t.feature_darkmode_auto||t.feature_darkmode&&t.feature_darkmode_auto&&"dark"==c)&&(te="ayu-dark",a("css/dark/ayu-dark.css")),e.isRichTextEditor?(re.insertAdjacentHTML("afterend",'<input type="hidden" class="scDarkMode" value="'+te+'" />'),re.insertAdjacentHTML("afterend",'<input type="hidden" class="scEditor" value="richTextEditor" />')):e.isHtmlEditor&&(ee.insertAdjacentHTML("afterend",'<input type="hidden" class="scDarkMode" value="'+te+'" />'),ee.insertAdjacentHTML("afterend",'<input type="hidden" class="scEditor" value="htmlEditor" />')),o("js/bundle-min.js")}}if(e.isEditorFolder&&(r("**** Editors folder ****","orange"),a("css/experimentalui.css"),T()),e.isGalleryVersion&&(r("**** Versions menu ****","orange"),a("css/experimentalui.css"),T()),e.isGalleryLanguage&&(r("**** Languages menu ****","orange"),null==t.feature_flags&&(t.feature_flags=!0),t.feature_flags)){a("css/experimentalui.css"),T();var ae,oe,ie,ne,se,ce,le=document.querySelector("#Languages"),ue=le.querySelectorAll(".scMenuPanelItem,.scMenuPanelItemSelected"),de=0;(ue=[].slice.call(ue).sort((function(e,t){return e.querySelector("table > tbody > tr > td > div > div:last-child").textContent>t.querySelector("table > tbody > tr > td > div > div:last-child").textContent?-1:1}))).forEach((function(e){le.appendChild(e)}));for(let r of ue){de=0,ae=r.getElementsByTagName("td");for(let r of ae)0==de?ne=r.getElementsByTagName("img"):(oe=(oe=r.getElementsByTagName("b"))[0].innerHTML,"0"!=(ie=(ie=(ie=r.getElementsByTagName("div"))[2].innerHTML).split(" "))[0]&&(se=r.getElementsByTagName("div"))[2].setAttribute("style","background-color: yellow; display: initial; padding: 0px 3px; color: #000000 !important"),oe=v(oe),ne[0].onerror=function(){this.src=e.iconFlagGeneric},ne[0].src=t.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+oe+".svg"):chrome.runtime.getURL("images/Flags/32x32/flag_"+oe+".png")),de++;0}}if(e.isPublishDialog&&(r("**** Publishing window ****","orange"),null==t.feature_flags&&(t.feature_flags=!0),t.feature_flags&&(j=document.querySelector("body"),F=new MutationObserver((function(r){var a,o=document.querySelectorAll("div[data-sc-id=CheckBoxListLanguages] > table:last-child")[0];if(null!=o&&o.children[0].children.length>1)for(var i of o.children[0].children)for(var n of i.children)if(a=v(n.innerText.trim()),null==n.querySelector("#scFlag")){let r=t.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+a+".svg"):chrome.runtime.getURL("images/Flags/16x16/flag_"+a+".png");n.querySelector("label > span").insertAdjacentHTML("beforebegin",' <img loading="lazy" id="scFlag" src="'+r+'" style="display: inline !important; vertical-align: middle; padding-right: 2px; width:16px;" onerror="this.onerror=null;this.src=\''+e.iconFlagGeneric+"';\"/>")}})),j&&F.observe(j,{attributes:!1,childList:!0,characterData:!1,subtree:!0}))),e.isPublishWindow){r("**** Publish / Rebuild / Package ****","orange"),null==t.feature_flags&&(t.feature_flags=!0);document.querySelector("form").getAttribute("action").split("id=")[1].replace("%7B","{").replace("%7D","}");if(t.feature_flags){var me=document.querySelectorAll("#Languages > label");for(let r of me){oe=v(r.innerText.trim());let a=t.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+oe+".svg"):chrome.runtime.getURL("images/Flags/16x16/flag_"+oe+".png");r.insertAdjacentHTML("beforebegin",' <img loading="lazy" id="scFlag" src="'+a+'" style="display: inline !important; vertical-align: middle; padding-right: 2px; width:16px" onerror="this.onerror=null;this.src=\''+e.iconFlagGeneric+"';\"/>")}}}let n='<div id="svgAnimation">'+e.svgAnimation+"</div>";document.querySelector("#EditorFrames")&&document.querySelector("#EditorFrames").insertAdjacentHTML("beforebegin",n),null==t.feature_autoexpand&&(t.feature_autoexpand=!0),null==t.feature_autoexpandcount&&(t.feature_autoexpandcount=!1),t.feature_autoexpand&&(document.addEventListener("click",(function(r){if(null!=r.target.offsetParent&&r.target.offsetParent.matches(".scContentTreeNodeNormal")){document.querySelector("#svgAnimation").setAttribute("style","opacity:1"),document.querySelector("#EditorFrames").setAttribute("style","opacity:0"),document.querySelector(".scContentTreeContainer").setAttribute("style","opacity:0.5"),document.querySelector(".scEditorTabHeaderActive > span").innerText=e.tabLoadingTitle,document.querySelector(".scPreviewButton")&&(document.querySelector(".scPreviewButton").innerText=e.tabLoadingTitle,document.querySelector(".scPreviewButton").disabled=!0);setTimeout((function(){document.querySelector("#svgAnimation").setAttribute("style","opacity:0"),document.querySelector("#EditorFrames").setAttribute("style","opacity:1"),document.querySelector(".scContentTreeContainer").setAttribute("style","opacity:1")}),8e3)}if(r.target.matches(".scContentTreeNodeGlyph")){let e=r.target.id;setTimeout((function(){if(document&&e){let r=document.querySelector("#"+e).nextSibling.nextSibling.nextSibling;if(r){let a=r.querySelectorAll(".scContentTreeNode");if(1==a.length&&a[0].querySelector(".scContentTreeNodeGlyph").click(),t.feature_autoexpandcount){let t=document.querySelector("#"+e).nextSibling.nextSibling;t.querySelector(".scContentTreeNodeIcon"),t.innerText;document.querySelectorAll(".scCountNodes").forEach((function(e){e.setAttribute("style","display:none")}))}}else{let t=document.querySelector("#"+e).nextSibling.nextSibling;t.querySelector(".scCountNodes")&&t.querySelector(".scCountNodes").remove()}}}),200)}if(r.target.matches(".dynatree-expander")){let e=r.path[1];setTimeout((function(){if(document&&e){let t=e.nextSibling;if(console.log(t),t){let e=t.querySelectorAll(".dynatree-has-children");1==e.length&&e[0].querySelector(".dynatree-expander").click(),console.log(e)}}}),200)}}),!1),document.addEventListener("mousedown",(function(e){if(!e.target.matches(".glyph"))return;let t=e.target.id,r=e.target.src.includes("collapsed");setTimeout((function(){if(document&&t&&r){var e=document.querySelector("#"+t).closest("ul").nextSibling;if(e)e.querySelector(".glyph").click()}}),200)}),!1)),j=document.querySelector("#LastPage"),F=new MutationObserver((function(e){if(null==t.feature_notification&&(t.feature_notification=!0),null==t.feature_experimentalui&&(t.feature_experimentalui=!1),t.feature_notification){var r=(j=document.querySelector("#LastPage")).querySelector(".sc-text-largevalue").innerHTML,a=j.querySelector(".scFieldLabel").innerHTML;"Result:"==a&&(a="Finished "+document.querySelector("#ResultText").value.split("Finished")[1]),y(r,a),(t.feature_darkmode&&!t.feature_darkmode_auto||t.feature_darkmode&&t.feature_darkmode_auto&&"dark"==c)&&(u=!0);var o=parent.parent.document.querySelector("body");t.feature_experimentalui?p(o,u,!0):p(o,u)}})),j&&F.observe(j,{attributes:!0}),setTimeout((function(){let e=document.querySelector("body").getBoundingClientRect().height,t=!!document.querySelector(".scContentTreeNodeActive > span")&&document.querySelector(".scContentTreeNodeActive > span").getBoundingClientRect().top,r=t>e?t-e+e/2:0;document.querySelector(".scContentTree")&&(document.querySelector(".scContentTree").scrollTop=r)}),1e3),j=document.querySelector("#scLanguage"),F=new MutationObserver((function(t){r("*** Update UI ***","yellow");var a=document.querySelector(".scEditorHeaderQuickInfoInput");if(a){l();var o=a.getAttribute("value"),i=document.querySelector("#scLanguage").getAttribute("value").toLowerCase();let t=document.querySelector(".scEditorHeaderVersionsVersion > span");t=null!=t?t.innerText:1;var n=document.querySelectorAll(".scEditorQuickInfo"),s=(n[n.length-1],n.length),c=document.getElementsByClassName("scEditorHeaderTitle"),u=document.querySelectorAll(".scEditorHeaderQuickInfoInput"),d=u[u.length-2].getAttribute("value"),m=localStorage.getItem("scBackPrevious");if(!e.hasRedirection&&!e.hasRedirectionOther)if("true"!=m){var g={sitecore:!0,id:o,language:i,version:t};history.pushState(g,void 0,"#"+o+"_"+i+"_"+t)}else localStorage.removeItem("scBackPrevious");if(e.debug&&console.info("%c - Tabs opened: "+s+" ","font-size:12px; background: #7b3090; color: white; border-radius:5px; padding 3px;"),s>1&&!document.getElementById("showInContentTree"+s)){var p=window.location.href,f=(p=p.split("#"))[0]+"&reload#"+d;c[s-1].insertAdjacentHTML("afterend",'[<a id="showInContentTree'+s+'" href="" onclick="javascript:window.location.href=\''+f+"'; return false;\" />Show in content tree</a>]")}}t.forEach((function(e){"attributes"==e.type&&b()}))})),j&&F.observe(j,{attributes:!0})}if(e.isEditMode&&!e.isLoginPage||e.isPreviewMode&&!e.isLoginPage){r("Experience Editor detected","red"),a("css/onload-min.css"),a("css/tooltip-min.css"),o("js/inject.js");var ge=document.querySelector("[data-sc-itemid]");if(ge){var pe=decodeURI(ge.getAttribute("data-sc-itemid"));s(pe,"en",1)}if(e.isGalleryLanguageExpEd&&(r("**** Languages menu ****","yellow"),null==t.feature_flags&&(t.feature_flags=!0),t.feature_flags)){var fe;ue=(le=document.querySelector(".sc-gallery-content")).querySelectorAll(".sc-gallery-option-content,.sc-gallery-option-content-active"),0,de=0,(ue=[].slice.call(ue).sort((function(e,t){return e.querySelector("div > div:last-child > span").textContent>t.querySelector("div > div:last-child > span").textContent?-1:1}))).forEach((function(e){le.appendChild(e)}));for(let e of ue){fe=e.closest(".sc-gallery-option-content,.sc-gallery-option-content-active"),oe=e.querySelector(".sc-gallery-option-content-header > span").innerText,"0"!=(se=(ie=e.querySelector(".sc-gallery-option-content-description > span")).innerHTML.split(" "))[0]&&ie.setAttribute("style","background-color: yellow; display: initial; padding: 0px 3px; color: #000000 !important"),oe=v(oe);let r=t.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+oe+".svg"):chrome.runtime.getURL("images/Flags/32x32/flag_"+oe+".png");fe.setAttribute("style","padding-left:48px; background-image: url("+r+"); background-repeat: no-repeat; background-position: 5px;")}}if(e.isRibbon){r("**** Ribbon ****","yellow");var ye=document.querySelector(".flag_generic_24");for(ce in oe=ye.nextSibling.innerText,oe=h(oe),e.jsonData)e.jsonData.hasOwnProperty(ce)&&oe==e.jsonData[ce].language.toUpperCase()&&(oe=e.jsonData[ce].flag);let a=t.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+oe+".svg"):chrome.runtime.getURL("images/Flags/24x24/flag_"+oe+".png");ye.setAttribute("style","background-image: url("+a+"); background-repeat: no-repeat; background-position: top left;")}j=document.querySelector(".scChromeControls"),F=new MutationObserver((function(e){var t=document.querySelectorAll(".scChromeToolbar");for(var r of t){r.setAttribute("style","margin-left:50px");var a=r.querySelectorAll(".scChromeCommand");r.querySelector(".scChromeText"),r.querySelector(".scChromeCommandText");for(var o of a){var i=o.getAttribute("title");o.setAttribute("style","z-index:auto"),null!=i&&(o.setAttribute("data-tooltip",i),o.classList.add("t-bottom"),o.classList.add("t-sm"),o.removeAttribute("title"))}}})),j&&F.observe(j,{attributes:!0,childList:!0,characterData:!0});var he=document.querySelector(".pagemode-edit");!he&&(he=document.querySelector(".on-page-editor")),!he&&(he=document.querySelector(".experience-editor")),!he&&(he=document.querySelector(".scWebEditRibbon"));e.windowLocationHref.includes("?"),document.querySelector("#scCrossPiece"),document.querySelector("#scWebEditRibbon"),document.querySelector(".sc-messageBar");let i;var ve;null==t.feature_darkmode&&(t.feature_darkmode=!1),null==t.feature_darkmode_auto&&(t.feature_darkmode_auto=!1),null==t.feature_experienceeditor&&(t.feature_experienceeditor=!0),t.feature_experienceeditor&&a("css/reset-min.css"),(t.feature_darkmode&&!t.feature_darkmode_auto&&e.isRibbon||t.feature_darkmode&&!t.feature_darkmode_auto&&e.isDialog||t.feature_darkmode&&!t.feature_darkmode_auto&&e.isInsertPage||t.feature_darkmode&&t.feature_darkmode_auto&&e.isRibbon&&"dark"==c||t.feature_darkmode&&t.feature_darkmode_auto&&e.isDialog&&"dark"==c||t.feature_darkmode&&t.feature_darkmode_auto&&e.isInsertPage&&"dark"==c)&&a("css/dark/experience-min.css"),(t.feature_darkmode&&!t.feature_darkmode_auto||t.feature_darkmode&&t.feature_darkmode_auto&&"dark"==c)&&(i="dark"),j=document.body,F=new MutationObserver((function(e){for(var t of e)for(var r of t.addedNodes)if("scCrossPiece"==r.id){var a='<div class="scExpTab '+i+'"><span class="tabHandle"></span><span class="tabText" onclick="toggleRibbon()">▲ Hide<span></div>';r.insertAdjacentHTML("afterend",a),F.disconnect(),d()}})),t.feature_experienceeditor&&j&&F.observe(j,{attributes:!1,childList:!0,characterData:!1}),ve=e.isEditMode?e.windowLocationHref.replace("sc_mode=edit","sc_mode=normal"):e.isPreviewMode?e.windowLocationHref.replace("sc_mode=preview","sc_mode=normal"):e.windowLocationHref.includes("?")?e.windowLocationHref+"&sc_mode=normal":e.windowLocationHref+"?sc_mode=normal",t.feature_experienceeditor&&!e.isRibbon&&(H='<div class="scNormalModeTab '+i+'"><span class="t-right t-sm" data-tooltip="Open in Normal Mode"><a href="'+ve+'"><img loading="lazy" src="'+e.iconChrome+'"/></a></span></div>',he&&he.insertAdjacentHTML("afterend",H)),t.feature_experienceeditor&&!e.isRibbon&&(H='<div class="scContentEditorTab '+i+'"><span class="t-right t-sm" data-tooltip="Open in Content Editor"><a href="'+window.location.origin+'/sitecore/shell/Applications/Content%20Editor.aspx?sc_bw=1"><img loading="lazy" src="'+e.iconCE+'"/></a></span></div>',he&&he.insertAdjacentHTML("afterend",H))}});