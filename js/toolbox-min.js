var debug=!1;function stripHtml(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}function sendNotification(e,t){new Notification(e,{body:t,icon:chrome.runtime.getURL("images/icon.png")})}function _addEnvironmentLabel(){var e=0,t=chrome.runtime.getURL("images/rocket.png"),s=chrome.runtime.getURL("images/error.png"),n=chrome.runtime.getURL("images/edit.png"),a=chrome.runtime.getURL("images/flags/");let r=document.querySelector(".scEditorHeader");document.querySelector(".scEditorHeaderTitle");document.getElementsByClassName("scEditorQuickInfo");let i=document.querySelector(".scEditorHeaderQuickInfoInput"),o=document.querySelector(".scEditorHeaderVersionsLanguage"),c=document.querySelector(".scEditorTabHeaderActive");var l=document.getElementsByClassName("scValidationMarkerIcon");let d=document.querySelector("#EditorFrames");if(i){var m=document.getElementsByClassName("scEditorHeaderQuickInfoInput"),g=m[0].getAttribute("value"),u=m[1].getAttribute("value"),f=u,p=!1,v=(u=u.split("/Home/"))[0];v=(v=v.split("/")).slice(-1)[0],"Data"==(m=f.split("/"))[m.length-1]&&(p=!0);var h=document.getElementById("scLanguage").getAttribute("value").toLowerCase(),y=window.location.origin+"/?sc_itemid="+g+"&sc_mode=normal&sc_lang="+h+"&sc_site="+v,b=(m=document.getElementsByClassName("scEditorHeaderVersionsLanguage"))[0].getAttribute("title"),B=(stripHtml(m[0].innerHTML),(u=null!=u[1]?encodeURI(window.location.origin+"/"+h+"/"+u[1]+"?sc_site="+v+"&sc_mode=normal").toLowerCase():encodeURI(window.location.origin+"/"+h+"/?sc_site="+v).toLowerCase()).includes("/data/"));p||u==encodeURI(window.location.origin+"/"+h+"/?sc_site="+v).toLowerCase()||B||chrome.storage.sync.get(["feature_urls"],(function(e){if(!document.getElementById("scMessageBarUrl")&&e.feature_urls){var s='<div id="scMessageBarUrl" class="scMessageBar scWarning"><div class="scMessageBarIcon" style="background-image:url('+t+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">Sitecore Live URL</div><div class="scMessageBarText">If you want to preview this page in <b>'+b+'</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+u+'" target="_blank" class="scMessageBarOption">Open this link</a> or try <a href="'+y+'" target="_blank" class="scMessageBarOption">this alternative link</a></li></ul></div></div>';r.insertAdjacentHTML("afterend",s)}})),B&&(u=u.split("/data/"),chrome.storage.sync.get(["feature_urls"],(function(e){if(!document.getElementById("scMessageBarInfo")&&e.feature_urls){var t='<div id="scMessageBarInfo" class="scMessageBar scInformation"><div class="scMessageBarIcon" style="background-image:url('+n+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">You are editing a data source...</div><div class="scMessageBarText">To see it, you need to add/edit it to your page via the</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+u[0]+'?sc_mode=edit" target="_blank" class="scMessageBarOption">Experience Editor</a> or <a href="" class="scMessageBarOption" onclick="javascript:return scForm.invoke(\'item:setlayoutdetails\', event)">Presentation details<a></li></ul></div></div>';r.insertAdjacentHTML("afterend",t)}}))),chrome.storage.sync.get(["feature_flags"],(function(e){!document.getElementById("scFlag")&&e.feature_flags&&c.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+a+h+'.png" style="width: 20px; vertical-align: middle; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+a+"missing.png';\" />"),e.feature_flags&&o.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+a+h+'.png" style="width: 15px; vertical-align: sub; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+a+"missing.png';\" />")}))}chrome.storage.sync.get(["feature_errors"],(function(t){if(null!=l[0]&&t.feature_errors){var n='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+s+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let t of l)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=t.getAttribute("src")&&(n+='<li class="scMessageBarOptionBullet" onclick="'+t.getAttribute("onclick")+'" style="cursor:pointer;">'+t.getAttribute("title")+"</li>",e++);n+="</ul></div></div>",e>0&&r.insertAdjacentHTML("afterend",n)}}));var E=document.getElementById("EditorFrames");if(E){var M,L,k;E=E.getElementsByTagName("iframe"),e=0;for(let t of E)if(M=E[e].src,L=E[e],k=M.includes("/Media/"),e++,k)break;chrome.storage.sync.get(["feature_dragdrop"],(function(e){if(k&&e.feature_dragdrop)L.onload=function(){var e='<iframe id="sitecorAuthorToolbox" class="sitecorAuthorToolbox" src="'+("/sitecore/client/Applications/Dialogs/UploadMediaDialog?fo=sitecore://master/{"+(M=(M=M.split("id=%7B"))[1].split("%7B"))[0]+"}")+'" style="width:100%; height:500px; margin-top: -60px; resize: vertical;"></iframe>';L.setAttribute("style","margin-top: -60px;");var t=document.getElementById("sitecorAuthorToolbox");t&&(t.remove(),debug&&console.info("Remove iFrame from DOM")),d.insertAdjacentHTML("afterbegin",e)};else{var t=document.getElementById("sitecorAuthorToolbox");t&&(t.remove(),debug&&console.info("Remove iFrame from DOM (no folder)"))}}))}!0===debug&&(console.info("Media folder:"+k),console.info("Active language: "+h)),window.Notification?"granted"===Notification.permission||Notification.requestPermission().then((function(e){"granted"===e||console.info("User blocked notifications.")})).catch((function(e){console.error(e)})):console.info("Browser does not support notifications.")}chrome.storage.sync.get(["feature_darkmode"],(function(e){if(null==e.feature_darkmode&&(e.feature_darkmode=!1),e.feature_darkmode&&"/sitecore/login"!=window.location.pathname){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/default-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/ribbon-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/contentmanager-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/dialogs-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/gallery-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/speak-min.css"),document.getElementsByTagName("head")[0].appendChild(t)}}));var MutationObserver=window.MutationObserver,elementObserver=new MutationObserver((function(e){debug&&console.info("Change"),e.forEach((function(e){console.info(e),"attributes"==e.type&&_addEnvironmentLabel()}))})),element=document.getElementById("scLanguage");element&&(debug&&console.info("First load"),_addEnvironmentLabel(),elementObserver.observe(element,{attributes:!0}));var elementObserver2=new MutationObserver((function(e){e.forEach((function(e){"attributes"==e.type&&_addEnvironmentLabel()})),chrome.storage.sync.get(["feature_notification"],(function(e){if(e.feature_notification){element2.getElementsByClassName("DialogHeader").item(0).innerHTML;sendNotification(element2.getElementsByClassName("sc-text-largevalue").item(0).innerHTML,element2.getElementsByClassName("scFieldLabel").item(0).innerHTML)}})),debug&&console.info("Publish Done")})),element2=document.getElementById("LastPage");element2&&(debug&&console.info("Open publish"),_addEnvironmentLabel(),elementObserver2.observe(element2,{attributes:!0}));