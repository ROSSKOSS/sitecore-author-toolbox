import*as global from"./modules/global.js";import*as local from"./modules/local.js";import{consoleLog,loadCssFile,loadJsFile,exeJsCode,preferesColorScheme,sitecoreItemJson,fetchTimeout,getScItemData,repositionElement,startDrag}from"./modules/helpers.js";import{showSnackbar}from"./modules/snackbar.js";import{checkWorkbox}from"./modules/workbox.js";import{checkUrlStatus}from"./modules/url.js";import{checkNotification,sendNotification}from"./modules/notification.js";import{cleanCountryName,findCountryName}from"./modules/language.js";import{sitecoreAuthorToolbox}from"./modules/contenteditor.js";import{getGravatar}from"./modules/users.js";import{instantSearch}from"./modules/instantsearch.js";import{insertModal,insertPanel}from"./modules/menu.js";import{insertSavebar,insertBreadcrumb,initInsertIcon,initGutter,getAccentColor,initColorPicker,initSitecoreMenu,initUserMenu}from"./modules/experimentalui.js";chrome.storage.sync.get(e=>{consoleLog(window.location.href.replace("https://","").replace("http://",""),"green");let t=preferesColorScheme(),o=!1;if(global.isSitecore&&!global.isEditMode&&!global.isLoginPage&&!global.isCss&&!global.isUploadManager){
//!global.isRichTextEditor ? document.querySelector('body').insertAdjacentHTML( 'beforeend', '<input type="hidden" class="extensionId" value="' + global.extensionId + '" />' ) : false;
if(loadCssFile("css/onload-min.css"),loadJsFile("js/inject.js"),null==e.feature_darkmode&&(e.feature_darkmode=!1),null==e.feature_darkmode_auto&&(e.feature_darkmode_auto=!1),null==e.feature_experimentalui&&(e.feature_experimentalui=!1),1!=e.feature_experimentalui&&((!e.feature_darkmode||e.feature_darkmode_auto||global.isTelerikUi||global.isExperienceEditor||global.isAdminCache||global.isContentHome||global.isLoginPage||global.isEditMode||global.isRules||global.isAdmin)&&(!e.feature_darkmode||!e.feature_darkmode_auto||global.isTelerikUi||global.isExperienceEditor||global.isAdminCache||global.isContentHome||global.isLoginPage||global.isEditMode||global.isRules||global.isAdmin||"dark"!=t)||(o=!0,loadCssFile("css/dark/default-min.css"),loadCssFile("css/dark/ribbon-min.css"),loadCssFile("css/dark/contentmanager-min.css"),loadCssFile("css/dark/dialogs-min.css"),loadCssFile("css/dark/gallery-min.css"),loadCssFile("css/dark/speak-min.css"),0==navigator.platform.indexOf("Win")&&loadCssFile("css/dark/scrollbars-min.css"))),checkNotification(),global.isContentEditor||global.isLaunchpad){if(consoleLog("**** Content Editor / Launchpage ****","yellow"),null==e.feature_experimentalui&&(e.feature_experimentalui=!1),null==e.feature_contrast_icons&&(e.feature_contrast_icons=!0),!global.isLaunchpad&&e.feature_experimentalui){let t=getScItemData();loadCssFile("css/experimentalui-min.css"),e.feature_darkmode&&!e.feature_darkmode_auto&&!global.isTelerikUi&&!global.isExperienceEditor&&!global.isAdminCache&&!global.isContentHome&&!global.isLoginPage&&!global.isEditMode&&!global.isRules&&!global.isAdmin||e.feature_darkmode&&e.feature_darkmode_auto&&!global.isTelerikUi&&!global.isExperienceEditor&&!global.isAdminCache&&!global.isContentHome&&!global.isLoginPage&&!global.isEditMode&&!global.isRules&&global.isAdmin;let o='<div id="svgAnimation">'+global.svgAnimation+"</div>";document.querySelector("#EditorFrames")&&document.querySelector("#EditorFrames").insertAdjacentHTML("beforebegin",o);let a=document.querySelector("#SearchPanel");a&&(a.innerHTML="Content"),0==e.feature_contrast_icons&&(document.documentElement.style.setProperty("--iconBrightness",1),document.documentElement.style.setProperty("--iconContrast",1)),insertSavebar(),insertModal(t.id,t.language,t.version),insertPanel(),initInsertIcon(),initGutter(),initUserMenu(),initColorPicker(),initSitecoreMenu(),document.addEventListener("click",e=>{let t=document.querySelector("#EditorTabs").getBoundingClientRect().bottom,o=document.querySelector("#scPanel"),a=document.querySelector("#scLanguageIframe"),r=document.querySelector("#scVersionIframe");o.setAttribute("style","top: "+t+"px !important"),a.setAttribute("style","top: "+t+"px !important"),r.setAttribute("style","top: "+t+"px !important"),document.querySelector(".scPublishMenu")&&("scPublishMenuMore"==e.srcElement.id?document.querySelector(".scPublishMenu").classList.toggle("visible"):document.querySelector(".scPublishMenu").classList.remove("visible")),document.querySelector(".scMoreMenu")&&("scMoreButton"==e.srcElement.id||"scMoreButton"==e.path[1].id?document.querySelector(".scMoreMenu").classList.toggle("visible"):document.querySelector(".scMoreMenu").classList.remove("visible")),"scInfoButton"==e.srcElement.id||"scInfoButton"==e.path[1].id||"scPanel"==e.srcElement.id||"content"==e.path[0].className?o.classList.toggle("open"):o.classList.remove("open"),"scLanguageButton"==e.srcElement.id||"scLanguageButton"==e.path[1].id?a.classList.toggle("open"):a.classList.remove("open"),"scVersionButton"==e.srcElement.id||"scVersionButton"==e.path[1].id?r.classList.toggle("open"):r.classList.remove("open"),document.querySelector(".scPublishMenu"),document.querySelector("#scModal")&&("scOverlay"==e.srcElement.className&&document.querySelector(".scOverlay").setAttribute("style","visibility: hidden"),"scOverlay"==e.srcElement.className&&document.querySelector("#scModal").setAttribute("style","opacity:0; visibility: hidden; top: calc(50% - 550px/2 - 10px)"))})}if(null==e.feature_instantsearch&&(e.feature_instantsearch=!0),!global.isLaunchpad&&e.feature_instantsearch){let e=document.querySelector(".sc-globalHeader"),t='<input type="text" class="scInstantSearch scIgnoreModified" placeholder="Search for content or media" tabindex="1" accesskey="f">',o='<ul class="scInstantSearchResults"></ul>';e&&e.insertAdjacentHTML("afterbegin",o),e&&e.insertAdjacentHTML("afterbegin",t),e&&instantSearch()}if(window.onpopstate=function(e){e.state&&""!=e.state.id&&(localStorage.setItem("scBackPrevious",!0),exeJsCode('scForm.invoke("item:load(id='+e.state.id+",language="+e.state.language+",version="+e.state.version+')");'))},e.feature_darkmode&&e.feature_darkmode_auto){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{exeJsCode("scForm.invoke('contenteditor:save', event)"),setTimeout((function(){window.location.reload()}),500)})}if(!global.hasRedirectionOther&&!global.isLaunchpad)if(null==e.feature_reloadnode&&(e.feature_reloadnode=!0),null==e.scData||global.urlParams.get("fo")||global.urlParams.get("ro"))sitecoreAuthorToolbox();else{if(""!=global.scUrlHash)j=global.scUrlHash.split("_"),e.scItemID=j[0],e.scLanguage=j[1],e.scVersion=j[2],e.scSource="Hash";else{var a=e.scData;for(var r in a)a.hasOwnProperty(r)&&r==window.location.origin&&(e.scItemID=a[r].scItemID,e.scLanguage=a[r].scLanguage,e.scVersion=a[r].scVersion,e.scSource="Storage")}null==e.scLanguage&&(e.scLanguage="en"),e.scItemID&&1==e.feature_reloadnode&&(consoleLog("[Read "+e.scSource+"] Item : "+e.scItemID,"beige"),consoleLog("[Read "+e.scSource+"] Language : "+e.scLanguage,"beige"),consoleLog("[Read "+e.scSource+"] Version : "+e.scVersion,"beige"),consoleLog("*** Redirection ***","yellow"),exeJsCode('scForm.invoke("item:load(id='+e.scItemID+",language="+e.scLanguage+",version="+e.scVersion+')");')),sitecoreAuthorToolbox()}if(null==e.feature_favorites&&(e.feature_favorites=!1),e.feature_favorites&&!global.isPublishWindow&&global.scContentTree){var l=document.querySelector("#sitecorAuthorToolboxFav");l&&l.remove();var i='<iframe loading="lazy" id="sitecorAuthorToolboxFav" class="sitecorAuthorToolboxFav" src="'+("../default.aspx?xmlcontrol=Gallery.Favorites&id="+getScItemData().id+"&la=en&vs=1")+'" style="width:100%; height:150px; margin-top: 0px; resize: vertical;"></iframe>';global.scContentTree.insertAdjacentHTML("afterend",i)}if(!global.isLaunchpad){let e=global.extensionVersion;localStorage.getItem("sbDismiss")!=e&&showSnackbar(e)}null==e.feature_workbox&&(e.feature_workbox=!0),!chrome.runtime.error&&1==e.feature_workbox&&checkWorkbox()}if(global.isDesktop&&!global.isGalleryFavorites&&!global.isXmlControl&&(consoleLog("**** Desktop Shell ****","orange"),null==e.feature_launchpad&&(e.feature_launchpad=!0),e.feature_experimentalui&&(loadCssFile("css/experimentalui-min.css"),initUserMenu(),initColorPicker(),initSitecoreMenu()),e.feature_launchpad)){var n='<a href="#" class="scStartMenuLeftOption" title="" onclick="window.location.href=\''+global.launchpadPage+"?launchpad=true&url="+global.windowLocationHref+'\'"><img loading="lazy" src="'+global.launchpadIcon+'" class="scStartMenuLeftOptionIcon" alt="" border="0"><div class="scStartMenuLeftOptionDescription"><div class="scStartMenuLeftOptionDisplayName">'+global.launchpadGroupTitle+'</div><div class="scStartMenuLeftOptionTooltip">'+global.launchpadTitle+"</div></div></a>",s=document.querySelectorAll(".scStartMenuLeftOption");for(let e of s)"Install and maintain apps."==e.getAttribute("title")&&e.insertAdjacentHTML("afterend",n)}if(global.isLaunchpad){if(consoleLog("**** Launchpad ****","orange"),null==e.feature_launchpad&&(e.feature_launchpad=!0),null==e.feature_launchpad_tiles&&(e.feature_launchpad_tiles=!1),e.feature_launchpad){var c=document.querySelectorAll(".last");n='<div class="sc-launchpad-group"><header class="sc-launchpad-group-title">'+global.launchpadGroupTitle+'</header><div class="sc-launchpad-group-row"><a href="#" onclick="window.location.href=\''+global.launchpadPage+"?launchpad=true&url="+global.windowLocationHref+'\'" class="sc-launchpad-item" title="'+global.launchpadTitle+'"><span class="icon"><img loading="lazy" src="'+global.launchpadIcon+'" width="48" height="48" alt="'+global.launchpadTitle+'"></span><span class="sc-launchpad-text">'+global.launchpadTitle+"</span></a></div></div>",c[0].insertAdjacentHTML("afterend",n)}e.feature_launchpad_tiles&&(e.feature_darkmode&&!e.feature_darkmode_auto||e.feature_darkmode&&e.feature_darkmode_auto&&"dark"==t?loadCssFile("css/dark/experimentalui-launchpad-min.css"):loadCssFile("css/experimentalui-launchpad-min.css"))}if(global.isSearch){consoleLog("**** Internal Search ****","orange");var d=document.querySelector("#results"),u=new MutationObserver((function(e){var t=document.querySelector("#results").querySelectorAll(".BlogPostArea");for(var o of t){var a=o.querySelector(".BlogPostFooter"),r=o.querySelector(".BlogPostViews > a > img").getAttribute("title");(r=(r=r.split(" - "))[1].toLowerCase()).includes("/home/")&&(r="/"+(r=r.split("/home/"))[1]);var l='<div class="BlogPostExtra BlogPostContent" style="padding: 5px 0 0px 78px; color: #0769d6"><strong>Sitecore path:</strong> '+r+" <strong>Languages available:</strong> "+o.querySelector(".BlogPostHeader > span").getAttribute("title")+"</div>";r&&a.insertAdjacentHTML("afterend",l)}}));d&&u.observe(d,{attributes:!1,childList:!0,characterData:!1,subtree:!1})}if(global.isFieldEditor){if(consoleLog("**** Field editor ****","orange"),null==e.feature_contenteditor&&(e.feature_contenteditor=!0),1==e.feature_contenteditor){var g=document.createElement("link");g.type="text/css",g.rel="stylesheet",g.href=chrome.runtime.getURL("css/checkbox-min.css"),document.getElementsByTagName("head")[0].appendChild(g)}if(null==e.feature_charscount&&(e.feature_charscount=!0),e.feature_charscount){var m,f,p,b=document.querySelectorAll("input, textarea, checkbox"),h=0;for(var y of b)"scContentControl"==y.className||"scContentControlMemo"==y.className?(y.setAttribute("style","padding-right: 70px !important"),y.parentElement.setAttribute("style","position:relative !important"),h=y.value.length,p=h>1?h+" chars":h+" char",m='<div id="chars_'+y.id+'" style="position: absolute; bottom: 1px; right: 1px; padding: 6px 10px; border-radius: 4px; line-height: 20px; opacity:0.5;">'+p+"</div>",y.insertAdjacentHTML("afterend",m)):"scContentControlCheckbox"==y.className&&(f='<label for="'+y.id+'" class="scContentControlCheckboxLabel"></label>',y.insertAdjacentHTML("afterend",f));document.addEventListener("keyup",(function(e){"input"!=e.target.localName&&"textarea"!=e.target.localName||(h=e.target.value.length,p=h>1?h+" chars":h+" char",document.querySelector("#chars_"+e.target.id)&&(document.querySelector("#chars_"+e.target.id).innerText=p))}),!1)}var v=document.querySelectorAll(".scBucketListSelectedBox, .scContentControlMultilistBox"),_=document.querySelector("#Section_Data");(v=v[1]?v[1]:v[0])&&v.addEventListener("change",(function(){var e=v.value;e=e.includes("|")?e.split("|")[1]:e;var t=v[v.selectedIndex].text,o='<a class="scMessageBarOption" href="'+window.location.origin+"/sitecore/shell/Applications/Content%20Editor.aspx?sc_bw=1#"+e+'" target="_blank"><u>Click here ⧉</u></a> ',a='<div id="Warnings" class="scMessageBar scWarning"><div class="scMessageBarIcon" style="background-image:url('+global.icon+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">'+t+"</div>";a+='<span id="Information" class="scMessageBarText"><span class="scMessageBarOptionBullet">'+o+"</span> to edit this datasource in <b>Content Editor</b>.</span>",a+="</div></div>",document.querySelector(".scMessageBar")?(document.querySelector(".scMessageBarTitle").innerHTML=t,document.querySelector(".scMessageBarOptionBullet").innerHTML=o):_.insertAdjacentHTML("beforebegin",a)})),null==e.feature_errors&&(e.feature_errors=!0);var S=0,x=document.getElementsByClassName("scValidationMarkerIcon"),L=document.querySelector("#MainPanel");if(e.feature_errors){var k='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+global.iconError+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let e of x)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=e.getAttribute("src")&&(k+='<li class="scMessageBarOptionBullet" onclick="'+e.getAttribute("onclick")+'" style="cursor:pointer;">'+e.getAttribute("title")+"</li>",S++);let e,t;k+="</ul></div></div>",S>0&&L.insertAdjacentHTML("beforebegin",k),d=document.querySelector(".scValidatorPanel"),u=new MutationObserver((function(o){e&&clearTimeout(e),e=setTimeout((function(){t=document.querySelector("#scMessageBarError"),t&&t.parentNode.removeChild(t),S=0,x=document.querySelectorAll(" .scValidationMarkerIcon ");var e='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+global.iconError+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let t of x)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=t.getAttribute("src")&&(e+='<li class="scMessageBarOptionBullet" onclick="'+t.getAttribute("onclick")+'" style="cursor:pointer;">'+t.getAttribute("title")+"</li>",S++);e+="</ul></div></div>",S>0&&L.insertAdjacentHTML("beforebegin",e)}),1500)})),d&&u.observe(d,{attributes:!0,childList:!0,characterData:!0})}}if(global.isMediaFolder&&(consoleLog("**** Media Folder ****","orange"),null==e.feature_dragdrop&&(e.feature_dragdrop=!0),e.feature_experimentalui&&loadCssFile("css/experimentalui-min.css"),e.feature_dragdrop)){var C=window.location.href.split("id=%7B"),q=(C=(C=C[1].split("%7B"))[0].split("%7D"))[0],M="/sitecore/client/Applications/Dialogs/UploadMediaDialog?ref=list&ro=sitecore://master/%7b"+q+"%7d%3flang%3den&fo=sitecore://master/%7b"+q+"%7d",A=document.querySelector(".scFolderButtons"),T='<a href="#" class="scButton" onclick="javascript:scSitecore.prototype.showModalDialog(\''+M+"', '', '', null, null); false\"><img loading=\"lazy\" src=\" "+global.launchpadIcon+' " width="16" height="16" class="scIcon" alt="" border="0"><div class="scHeader">Upload files (Drag and Drop)</div></a>';A.insertAdjacentHTML("afterbegin",T)}if(global.isExperienceProfile&&(consoleLog("**** Experience Profile ****","orange"),null==e.feature_gravatarimage&&(e.feature_gravatarimage=!0),e.feature_gravatarimage&&(d=document.querySelector("body"),u=new MutationObserver((function(e){let t=document.querySelector("img[data-sc-id=InfoPhotoImage]"),o=document.querySelector("a[data-sc-id=InfoEmailLink]");t&&o&&o.innerHTML.includes("@")&&!t.src.includes("www.gravatar.com")&&(t.src=getGravatar(o.innerHTML,170),u.disconnect())})),d&&u.observe(d,{attributes:!1,childList:!0,characterData:!0,subtree:!0}))),(global.isRichTextEditor||global.isHtmlEditor)&&(consoleLog("**** Rich Text Editor ****","orange"),null==e.feature_rtecolor&&(e.feature_rtecolor=!0),null==e.feature_darkmode&&(e.feature_darkmode=!1),null==e.feature_darkmode_auto&&(e.feature_darkmode_auto=!1),e.feature_rtecolor)){var E,w="default";if(global.isRichTextEditor?E=document.querySelector("#Editor_contentIframe"):global.isHtmlEditor&&(E=document.querySelector("#ctl00_ctl00_ctl05_Html")),E){if(global.isRichTextEditor){document.querySelector("#Editor_contentIframe").contentWindow.document.body,document.querySelector("#EditorContentHiddenTextarea");var F=document.querySelector(".reTextArea")}loadCssFile("css/codemirror.css"),(e.feature_darkmode&&!e.feature_darkmode_auto||e.feature_darkmode&&e.feature_darkmode_auto&&"dark"==t)&&(w="ayu-dark",loadCssFile("css/dark/ayu-dark.css")),global.isRichTextEditor?(F.insertAdjacentHTML("afterend",'<input type="hidden" class="scDarkMode" value="'+w+'" />'),F.insertAdjacentHTML("afterend",'<input type="hidden" class="scEditor" value="richTextEditor" />')):global.isHtmlEditor&&(E.insertAdjacentHTML("afterend",'<input type="hidden" class="scDarkMode" value="'+w+'" />'),E.insertAdjacentHTML("afterend",'<input type="hidden" class="scEditor" value="htmlEditor" />')),loadJsFile("js/bundle-min.js")}}if(global.isContentEditorApp&&e.feature_experimentalui||global.isContentEditorApp&&e.feature_instantsearch){let e=document.querySelector("#globalLogo");e&&e.setAttribute("target","_parent")}if(global.isEditorFolder&&(consoleLog("**** Editors folder ****","orange"),e.feature_experimentalui&&(loadCssFile("css/experimentalui-min.css"),getAccentColor())),global.isXmlControl&&!global.isRichText&&consoleLog("**** XML Control (Window) ****","orange"),global.isGalleryVersion&&(consoleLog("**** Versions menu ****","orange"),e.feature_experimentalui&&(loadCssFile("css/experimentalui-min.css"),getAccentColor())),global.isGalleryLanguage&&(consoleLog("**** Languages menu ****","orange"),e.feature_experimentalui&&(loadCssFile("css/experimentalui-min.css"),getAccentColor()),null==e.feature_flags&&(e.feature_flags=!0),e.feature_flags)){var I,B,H,P,j,R=document.querySelector("#Languages"),N=R.querySelectorAll(".scMenuPanelItem,.scMenuPanelItemSelected"),D=0;(N=[].slice.call(N).sort((function(e,t){return e.querySelector("table > tbody > tr > td > div > div:last-child").textContent>t.querySelector("table > tbody > tr > td > div > div:last-child").textContent?-1:1}))).forEach((function(e){R.appendChild(e)}));for(let t of N){D=0,I=t.getElementsByTagName("td");for(let t of I)0==D?P=t.getElementsByTagName("img"):(B=(B=t.getElementsByTagName("b"))[0].innerHTML,"0"!=(H=(H=(H=t.getElementsByTagName("div"))[2].innerHTML).split(" "))[0]&&(j=t.getElementsByTagName("div"))[2].setAttribute("style","background-color: yellow; display: initial; padding: 0px 3px; color: #000000 !important"),B=findCountryName(B),P[0].onerror=function(){this.src=global.iconFlagGeneric},P[0].src=e.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+B+".svg"):chrome.runtime.getURL("images/Flags/32x32/flag_"+B+".png")),D++;0}}if(global.isPublishDialog&&(consoleLog("**** Publishing window ****","orange"),null==e.feature_flags&&(e.feature_flags=!0),e.feature_flags&&(d=document.querySelector("body"),u=new MutationObserver((function(t){var o,a=document.querySelectorAll("div[data-sc-id=CheckBoxListLanguages] > table:last-child")[0];if(null!=a&&a.children[0].children.length>1)for(var r of a.children[0].children)for(var l of r.children)if(o=findCountryName(l.innerText.trim()),null==l.querySelector("#scFlag")){let t=e.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+o+".svg"):chrome.runtime.getURL("images/Flags/16x16/flag_"+o+".png");l.querySelector("label > span").insertAdjacentHTML("beforebegin",' <img loading="lazy" id="scFlag" src="'+t+'" style="display: inline !important; vertical-align: middle; padding-right: 2px; width:16px;" onerror="this.onerror=null;this.src=\''+global.iconFlagGeneric+"';\"/>")}})),d&&u.observe(d,{attributes:!1,childList:!0,characterData:!1,subtree:!0}))),global.isPublishWindow){consoleLog("**** Publish / Rebuild / Package ****","orange"),null==e.feature_flags&&(e.feature_flags=!0);document.querySelector("form").getAttribute("action").split("id=")[1].replace("%7B","{").replace("%7D","}");if(e.feature_flags){var U=document.querySelectorAll("#Languages > label");for(let t of U){B=findCountryName(t.innerText.trim());let o=e.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+B+".svg"):chrome.runtime.getURL("images/Flags/16x16/flag_"+B+".png");t.insertAdjacentHTML("beforebegin",' <img loading="lazy" id="scFlag" src="'+o+'" style="display: inline !important; vertical-align: middle; padding-right: 2px; width:16px" onerror="this.onerror=null;this.src=\''+global.iconFlagGeneric+"';\"/>")}}}null==e.feature_autoexpand&&(e.feature_autoexpand=!0),null==e.feature_autoexpandcount&&(e.feature_autoexpandcount=!1),e.feature_autoexpand&&(document.addEventListener("click",(function(t){if(null!=t.target.offsetParent&&t.target.offsetParent.matches(".scContentTreeNodeNormal")){e.feature_experimentalui&&document.querySelector("#svgAnimation").setAttribute("style","opacity:1"),e.feature_experimentalui?document.querySelector("#EditorFrames").setAttribute("style","opacity:0"):document.querySelector("#EditorFrames").setAttribute("style","opacity:0.5"),document.querySelector(".scContentTreeContainer").setAttribute("style","opacity:0.5"),document.querySelector(".scEditorTabHeaderActive > span").innerText=global.tabLoadingTitle,document.querySelector(".scPreviewButton")&&(document.querySelector(".scPreviewButton").innerText=global.tabLoadingTitle,document.querySelector(".scPreviewButton").disabled=!0);setTimeout((function(){document.querySelector("#svgAnimation")&&document.querySelector("#svgAnimation").setAttribute("style","opacity:0"),document.querySelector("#EditorFrames").setAttribute("style","opacity:1"),document.querySelector(".scContentTreeContainer").setAttribute("style","opacity:1")}),8e3)}if(t.target.matches(".scContentTreeNodeGlyph")){let o=t.target.id;setTimeout((function(){if(document&&o){let t=document.querySelector("#"+o).nextSibling.nextSibling.nextSibling;if(t){let a=t.querySelectorAll(".scContentTreeNode");if(1==a.length&&a[0].querySelector(".scContentTreeNodeGlyph").click(),e.feature_autoexpandcount){let e=document.querySelector("#"+o).nextSibling.nextSibling;e.querySelector(".scContentTreeNodeIcon"),e.innerText;document.querySelectorAll(".scCountNodes").forEach((function(e){e.setAttribute("style","display:none")}))}}else{let e=document.querySelector("#"+o).nextSibling.nextSibling;e.querySelector(".scCountNodes")&&e.querySelector(".scCountNodes").remove()}}}),200)}if(t.target.matches(".dynatree-expander")){let e=t.path[1];setTimeout((function(){if(document&&e){let t=e.nextSibling;if(console.log(t),t){let e=t.querySelectorAll(".dynatree-has-children");1==e.length&&e[0].querySelector(".dynatree-expander").click(),console.log(e)}}}),200)}}),!1),document.addEventListener("mousedown",(function(e){if(!e.target.matches(".glyph"))return;let t=e.target.id,o=e.target.src.includes("collapsed");setTimeout((function(){if(document&&t&&o){var e=document.querySelector("#"+t).closest("ul").nextSibling;if(e)e.querySelector(".glyph").click()}}),200)}),!1)),d=document.querySelector("#LastPage"),u=new MutationObserver((function(a){if(null==e.feature_notification&&(e.feature_notification=!0),null==e.feature_experimentalui&&(e.feature_experimentalui=!1),e.feature_notification){var r=(d=document.querySelector("#LastPage")).querySelector(".sc-text-largevalue").innerHTML,l=d.querySelector(".scFieldLabel").innerHTML;"Result:"==l&&(l="Finished "+document.querySelector("#ResultText").value.split("Finished")[1]),sendNotification(r,l),(e.feature_darkmode&&!e.feature_darkmode_auto||e.feature_darkmode&&e.feature_darkmode_auto&&"dark"==t)&&(o=!0);var i=parent.parent.document.querySelector("body");checkUrlStatus(i.querySelector(".liveUrlStatus"),i,o,e.feature_experimentalui)}})),d&&u.observe(d,{attributes:!0}),d=document.querySelector("#scLanguage"),u=new MutationObserver((function(e){consoleLog("*** Update UI ***","yellow");var t=document.querySelector(".scEditorHeaderQuickInfoInput");if(t){getScItemData();var o=t.getAttribute("value"),a=document.querySelector("#scLanguage").getAttribute("value").toLowerCase();let e=document.querySelector(".scEditorHeaderVersionsVersion > span");e=null!=e?e.innerText:1;var r=document.querySelectorAll(".scEditorQuickInfo"),l=(r[r.length-1],r.length),i=document.getElementsByClassName("scEditorHeaderTitle"),n=document.querySelectorAll(".scEditorHeaderQuickInfoInput"),s=n[n.length-2].getAttribute("value"),c=localStorage.getItem("scBackPrevious");if(!global.hasRedirection&&!global.hasRedirectionOther&&!global.hasModePreview)if("true"!=c){var d={sitecore:!0,id:o,language:a,version:e};history.pushState(d,void 0,"#"+o+"_"+a+"_"+e)}else localStorage.removeItem("scBackPrevious");if(global.debug&&console.info("%c - Tabs opened: "+l+" ","font-size:12px; background: #7b3090; color: white; border-radius:5px; padding 3px;"),l>1&&!document.getElementById("showInContentTree"+l)){var u=window.location.href,g=(u=u.split("#"))[0]+"&reload#"+s;i[l-1].insertAdjacentHTML("afterend",'[<a id="showInContentTree'+l+'" href="" onclick="javascript:window.location.href=\''+g+"'; return false;\" />Show in content tree</a>]")}}e.forEach((function(e){"attributes"==e.type&&sitecoreAuthorToolbox()}))})),d&&u.observe(d,{attributes:!0})}if(global.isEditMode&&!global.isLoginPage||global.isPreviewMode&&!global.isLoginPage){consoleLog("Experience Editor detected","red"),loadCssFile("css/onload-min.css"),loadCssFile("css/tooltip-min.css"),loadJsFile("js/inject.js");let o=document.querySelector("[data-sc-itemid]"),a=document.querySelector("[data-sc-language]"),r=document.querySelector("[data-sc-version]");if(o&&r){var O=decodeURI(o.getAttribute("data-sc-itemid")),V=decodeURI(a.getAttribute("data-sc-language")),G=decodeURI(r.getAttribute("data-sc-version"));sitecoreItemJson(O,V,G)}if(global.isGalleryLanguageExpEd&&(consoleLog("**** Languages menu ****","yellow"),e.feature_experimentalui&&(loadCssFile("css/experimentalui-min.css"),getAccentColor()),null==e.feature_flags&&(e.feature_flags=!0),e.feature_flags)){var z;N=(R=document.querySelector(".sc-gallery-content")).querySelectorAll("a[data-sc-argument]"),0,D=0,(N=[].slice.call(N).sort((function(e,t){return e.querySelector("a > div > div:last-child > span").textContent>t.querySelector("a > div > div:last-child > span").textContent?-1:1}))).forEach((function(e){R.appendChild(e)}));for(let t of N){z=t.querySelector(".sc-gallery-option-content,.sc-gallery-option-content-active"),B=t.querySelector(".sc-gallery-option-content-header > span").innerText,"0"!=(j=(H=t.querySelector(".sc-gallery-option-content-description > span")).innerHTML.split(" "))[0]&&H.setAttribute("style","background-color: yellow; display: initial; padding: 0px 3px; color: #000000 !important"),B=findCountryName(B);let o=e.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+B+".svg"):chrome.runtime.getURL("images/Flags/32x32/flag_"+B+".png");z.setAttribute("style","padding-left:48px; background-image: url("+o+"); background-repeat: no-repeat; background-position: 5px; background-size: 32px")}}if(global.isRibbon){consoleLog("**** Ribbon ****","yellow");let t=document.querySelector(".flag_generic_24");if(t&&(B=t.nextSibling.innerText),B){B=findCountryName(B);let o=e.feature_experimentalui?chrome.runtime.getURL("images/Flags/svg/"+B+".svg"):chrome.runtime.getURL("images/Flags/24x24/flag_"+B+".png");t.setAttribute("style","background-image: url("+o+"); background-repeat: no-repeat; background-position: top left;")}}d=document.querySelector(".scChromeControls"),u=new MutationObserver((function(e){var t=document.querySelectorAll(".scChromeToolbar");for(var o of t){o.setAttribute("style","margin-left:50px");var a=o.querySelectorAll(".scChromeCommand"),r=(o.querySelector(".scChromeText"),o.querySelector(".scChromeCommandText"),!1);for(var l of a){var i=l.getAttribute("title");if(l.setAttribute("style","z-index:auto"),!r&&i)if(i.toLowerCase().includes("move component")||i.toLowerCase().includes("remove component")){document.querySelectorAll(".scFrameSideHorizontal, .scFrameSideVertical").forEach((function(e){e.classList.remove("scFrameYellow")}));r=!0}else{document.querySelectorAll(".scFrameSideHorizontal, .scFrameSideVertical").forEach((function(e){e.classList.add("scFrameYellow")}))}null!=i&&""!=i&&(l.setAttribute("data-tooltip",i),l.classList.add("t-bottom"),l.classList.add("t-md"),l.removeAttribute("title"))}}})),d&&u.observe(d,{attributes:!0,childList:!0,characterData:!0});var J=document.querySelector(".pagemode-edit");!J&&(J=document.querySelector(".on-page-editor")),!J&&(J=document.querySelector(".experience-editor")),!J&&(J=document.querySelector(".scWebEditRibbon"));global.windowLocationHref.includes("?"),document.querySelector("#scCrossPiece"),document.querySelector("#scWebEditRibbon"),document.querySelector(".sc-messageBar");let l;var W;null==e.feature_darkmode&&(e.feature_darkmode=!1),null==e.feature_darkmode_auto&&(e.feature_darkmode_auto=!1),null==e.feature_experienceeditor&&(e.feature_experienceeditor=!0),e.feature_experienceeditor&&loadCssFile("css/reset-min.css"),(e.feature_darkmode&&!e.feature_darkmode_auto&&global.isRibbon||e.feature_darkmode&&!e.feature_darkmode_auto&&global.isDialog||e.feature_darkmode&&!e.feature_darkmode_auto&&global.isInsertPage||e.feature_darkmode&&e.feature_darkmode_auto&&global.isRibbon&&"dark"==t||e.feature_darkmode&&e.feature_darkmode_auto&&global.isDialog&&"dark"==t||e.feature_darkmode&&e.feature_darkmode_auto&&global.isInsertPage&&"dark"==t)&&loadCssFile("css/dark/experience-min.css"),(e.feature_darkmode&&!e.feature_darkmode_auto||e.feature_darkmode&&e.feature_darkmode_auto&&"dark"==t)&&(l="dark"),d=document.body,u=new MutationObserver((function(e){for(var t of e)for(var o of t.addedNodes)if("scCrossPiece"==o.id){var a='<div class="scExpTab '+l+'">\n                        <span class="tabHandle"></span>\n                        <span class="tabText" onclick="toggleRibbon()">▲ Hide<span>\n                        </div>';o.insertAdjacentHTML("afterend",a),u.disconnect(),startDrag(),document.addEventListener("keydown",e=>{"Shift"===e.key&&(exeJsCode("toggleRibbon()"),e.preventDefault(),e.stopPropagation())})}})),e.feature_experienceeditor&&d&&u.observe(d,{attributes:!1,childList:!0,characterData:!1}),W=global.isEditMode?global.windowLocationHref.replace("sc_mode=edit","sc_mode=normal"):global.isPreviewMode?global.windowLocationHref.replace("sc_mode=preview","sc_mode=normal"):global.windowLocationHref.includes("?")?global.windowLocationHref+"&sc_mode=normal":global.windowLocationHref+"?sc_mode=normal",e.feature_experienceeditor&&!global.isRibbon&&(n='<div class="scNormalModeTab '+l+'"><span class="t-right t-sm" data-tooltip="Open in Normal Mode"><a href="'+W+'" target="_blank"><img loading="lazy" src="'+global.iconChrome+'"/></a></span></div>',J&&J.insertAdjacentHTML("afterend",n)),e.feature_experienceeditor&&!global.isRibbon&&(n='<div class="scContentEditorTab '+l+'"><span class="t-right t-sm" data-tooltip="Open in Content Editor"><a href="'+window.location.origin+'/sitecore/shell/Applications/Content%20Editor.aspx?sc_bw=1"><img loading="lazy" src="'+global.iconCE+'"/></a></span></div>',J&&J.insertAdjacentHTML("afterend",n)),e.feature_experienceeditor&&!global.isRibbon&&(n='<div class="scEditableTab '+l+'"><span class="t-right t-sm" data-tooltip="Show/hide editable content"><a onclick="showEditableContent()"><img loading="lazy" src="'+global.iconED+'" id="scEditableImg" class="grayscaleClass"/></a></span></div>',J&&J.insertAdjacentHTML("afterend",n))}});