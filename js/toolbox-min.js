var debug=!1;function stripHtml(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}function sendNotification(e,t){new Notification(e,{body:t,icon:chrome.runtime.getURL("images/icon.png")})}var link=document.createElement("link");function _addEnvironmentLabel(){var e=0,t=chrome.runtime.getURL("images/rocket.png"),s=chrome.runtime.getURL("images/error.png"),n=chrome.runtime.getURL("images/edit.png"),a=chrome.runtime.getURL("images/flags/");let r=document.querySelector(".scEditorHeader");document.querySelector(".scEditorHeaderTitle");document.getElementsByClassName("scEditorQuickInfo");let o=document.querySelector(".scEditorHeaderQuickInfoInput"),i=document.querySelector(".scEditorHeaderVersionsLanguage"),c=document.querySelector(".scEditorTabHeaderActive");var l=document.getElementsByClassName("scValidationMarkerIcon");let d=document.querySelector("#EditorFrames"),m=(document.getElementById("SearchPanel"),document.getElementById("ContentTreeHolder"));if(o){var g=document.getElementsByClassName("scEditorHeaderQuickInfoInput"),u=g[0].getAttribute("value"),f=g[1].getAttribute("value"),p=f,v=!1,h=(f=f.split("/Home/"))[0];h=(h=h.split("/")).slice(-1)[0],"Data"==(g=p.split("/"))[g.length-1]&&(v=!0);var y=document.getElementById("scLanguage").getAttribute("value").toLowerCase(),b=window.location.origin+"/?sc_itemid="+u+"&sc_mode=normal&sc_lang="+y+"&sc_site="+h,B=(g=document.getElementsByClassName("scEditorHeaderVersionsLanguage"))[0].getAttribute("title"),E=(stripHtml(g[0].innerHTML),(f=null!=f[1]?encodeURI(window.location.origin+"/"+y+"/"+f[1]+"?sc_site="+h+"&sc_mode=normal").toLowerCase():encodeURI(window.location.origin+"/"+y+"/?sc_site="+h).toLowerCase()).includes("/data/"));v||f==encodeURI(window.location.origin+"/"+y+"/?sc_site="+h).toLowerCase()||E||chrome.storage.sync.get(["feature_urls"],(function(e){if(!document.getElementById("scMessageBarUrl")&&e.feature_urls){var s='<div id="scMessageBarUrl" class="scMessageBar scWarning"><div class="scMessageBarIcon" style="background-image:url('+t+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">Sitecore Live URL</div><div class="scMessageBarText">If you want to preview this page in <b>'+B+'</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+f+'" target="_blank" class="scMessageBarOption">Open this link</a> or try <a href="'+b+'" target="_blank" class="scMessageBarOption">this alternative link</a></li></ul></div></div>';r.insertAdjacentHTML("afterend",s)}})),E&&(f=f.split("/data/"),chrome.storage.sync.get(["feature_urls"],(function(e){if(!document.getElementById("scMessageBarInfo")&&e.feature_urls){var t='<div id="scMessageBarInfo" class="scMessageBar scInformation"><div class="scMessageBarIcon" style="background-image:url('+n+')"></div><div class="scMessageBarTextContainer"><div class="scMessageBarTitle">You are editing a data source...</div><div class="scMessageBarText">To see it, you need to add/edit it to your page via the</b></div><ul class="scMessageBarOptions" style="margin:0px"><li class="scMessageBarOptionBullet"><a href="'+f[0]+'?sc_mode=edit" target="_blank" class="scMessageBarOption">Experience Editor</a></li></ul></div></div>';r.insertAdjacentHTML("afterend",t)}}))),chrome.storage.sync.get(["feature_flags"],(function(e){!document.getElementById("scFlag")&&e.feature_flags&&c.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+a+y+'.png" style="width: 20px; vertical-align: middle; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+a+"missing.png';\" />"),e.feature_flags&&i.insertAdjacentHTML("afterbegin",'<img id="scFlag" src="'+a+y+'.png" style="width: 15px; vertical-align: sub; padding: 0px 5px 0px 0px;" onerror="this.onerror=null;this.src=\''+a+"missing.png';\" />")}))}chrome.storage.sync.get(["feature_errors"],(function(t){if(null!=l[0]&&t.feature_errors){var n='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+s+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let t of l)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=t.getAttribute("src")&&(n+='<li class="scMessageBarOptionBullet" onclick="'+t.getAttribute("onclick")+'" style="cursor:pointer;">'+t.getAttribute("title")+"</li>",e++);n+="</ul></div></div>",e>0&&r.insertAdjacentHTML("afterend",n);var a=document.querySelector(".scValidatorPanel");new MutationObserver((function(t){e=0;var n='<div id="scMessageBarError" class="scMessageBar scError"><div class="scMessageBarIcon" style="background-image:url('+s+')"></div><div class="scMessageBarTextContainer"><ul class="scMessageBarOptions" style="margin:0px">';for(let t of l)"/sitecore/shell/themes/standard/images/bullet_square_yellow.png"!=t.getAttribute("src")&&(n+='<li class="scMessageBarOptionBullet" onclick="'+t.getAttribute("onclick")+'" style="cursor:pointer;">'+t.getAttribute("title")+"</li>",e++);if(n+="</ul></div></div>",e>0)r.insertAdjacentHTML("afterend",n);else{var a=document.getElementById("scMessageBarError");a&&a.parentNode.removeChild(a)}debug&&console.log("Changement: "+document.getElementsByClassName("scValidatorPanel"))})).observe(a,{attributes:!0,childList:!0,characterData:!0})}}));var M=document.getElementById("EditorFrames");if(M){var I,L,x;M=M.getElementsByTagName("iframe"),e=0;for(let t of M)if(I=M[e].src,L=M[e],x=I.includes("/Media/"),e++,x){debug&&console.info("SRC of MEDIA IFRAME "+e+" - "+I);break}chrome.storage.sync.get(["feature_dragdrop"],(function(e){if(x&&e.feature_dragdrop)L.onload=function(){var e='<iframe id="sitecorAuthorToolbox" class="sitecorAuthorToolbox" src="'+("/sitecore/client/Applications/Dialogs/UploadMediaDialog?fo=sitecore://master/{"+(I=(I=I.split("id=%7B"))[1].split("%7B"))[0]+"}")+'" style="width:100%; height:500px; margin-top: -60px; resize: vertical;"></iframe>';L.setAttribute("style","margin-top: -30px;");var t=document.getElementById("sitecorAuthorToolbox");t&&(t.remove(),debug&&console.info("Remove iFrame from DOM")),d.insertAdjacentHTML("afterbegin",e)};else{var t=document.getElementById("sitecorAuthorToolbox");t&&(t.remove(),debug&&console.info("Remove iFrame from DOM (no folder)"))}}))}window.Notification?"granted"===Notification.permission||Notification.requestPermission().then((function(e){"granted"===e||console.info("User blocked notifications.")})).catch((function(e){console.warn(e)})):console.info("Browser does not support notifications."),chrome.storage.sync.get(["feature_favorites"],(function(e){if(null==e.feature_favorites||e.feature_favorites){var t=document.getElementById("sitecorAuthorToolboxFav");t&&t.remove();var s='<iframe id="sitecorAuthorToolboxFav" class="sitecorAuthorToolboxFav" src="'+("../default.aspx?xmlcontrol=Gallery.Favorites&id="+u+"&la="+y+"&vs=1")+'" style="width:100%; height:125px; margin-top: 0px; resize: vertical;"></iframe>';m.insertAdjacentHTML("afterend",s)}})),!0===debug&&(console.info("Item ID: "+u),console.info("Language: "+y),console.info("Version: na"))}link.type="text/css",link.rel="stylesheet",link.href=chrome.runtime.getURL("css/onload-min.css"),document.getElementsByTagName("head")[0].appendChild(link),chrome.storage.sync.get(["feature_darkmode"],(function(e){if(null==e.feature_darkmode&&(e.feature_darkmode=!1),debug&&console.log("Pathname: "+window.location.pathname),e.feature_darkmode&&"/sitecore/login"!=window.location.pathname&&"/sitecore/client/Applications/ExperienceEditor/Ribbon.aspx"!=window.location.pathname){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/default-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/ribbon-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/contentmanager-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/dialogs-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/gallery-min.css"),document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=chrome.runtime.getURL("css/dark/speak-min.css"),document.getElementsByTagName("head")[0].appendChild(t)}}));var MutationObserver=window.MutationObserver,elementObserver=new MutationObserver((function(e){debug&&console.info("**Update UI**");var t=document.getElementsByClassName("scEditorHeaderQuickInfoInput")[0].getAttribute("value"),s=document.getElementById("scLanguage").getAttribute("value").toLowerCase();chrome.storage.sync.set({scItemID:t},(function(){debug&&console.info(">> Store ItemID: "+t)})),chrome.storage.sync.set({scLanguage:s},(function(){debug&&console.info(">> Store Language: "+s)})),e.forEach((function(e){"attributes"==e.type&&_addEnvironmentLabel()}))})),element=document.getElementById("scLanguage");if(element){debug&&console.info("**Reload**");var scLanguage=element.getAttribute("value").toLowerCase();chrome.storage.sync.get(["scItemID","feature_reloadnode"],(function(e){if(!chrome.runtime.error&&null!=e.scItemID&&e.scItemID&&1==e.feature_reloadnode){var t='scForm.invoke("item:load(id='+e.scItemID+",language="+scLanguage+',version=1)");',s=document.createElement("script");s.textContent=t,(document.head||document.documentElement).appendChild(s),s.remove(),debug&&console.info(">> User Preference -----\x3e "+e.feature_reloadnode),debug&&console.info(">> GoTo ItemID -----\x3e  "+e.scItemID)}})),_addEnvironmentLabel(),elementObserver.observe(element,{attributes:!0})}var elementObserver2=new MutationObserver((function(e){e.forEach((function(e){"attributes"==e.type&&_addEnvironmentLabel()})),chrome.storage.sync.get(["feature_notification"],(function(e){if(e.feature_notification){element2.getElementsByClassName("DialogHeader").item(0).innerHTML;sendNotification(element2.getElementsByClassName("sc-text-largevalue").item(0).innerHTML,element2.getElementsByClassName("scFieldLabel").item(0).innerHTML)}})),debug&&console.info("**Publish Done**")})),element2=document.getElementById("LastPage");element2&&(debug&&console.info("**Open dialog**"),_addEnvironmentLabel(),elementObserver2.observe(element2,{attributes:!0}));