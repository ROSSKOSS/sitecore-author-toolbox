async function getCurrentTab(){let queryOptions={active:!0,currentWindow:!0},[tab]=await chrome.tabs.query(queryOptions);return tab}function onRightClickHandler(info,tab){"SitecoreAuthorToolbox"==info.menuItemId&&chrome.storage.sync.get(["domain_manager"],result=>{console.log(result.domain_manager);var domains=result.domain_manager,cmUrl=new URL(tab.url),cd=!1;for(var domain in domains)if(cmUrl.origin==domains[domain]){cmUrl=domain+cmUrl.pathname,cd=!0;break}function openEE(cmUrl){window.open(`${cmUrl}?sc_mode=edit`)}cmUrl=cd?`${cmUrl.origin}${cmUrl.pathname}`:`${cmUrl.origin}/sitecore/${cmUrl.pathname}`,chrome.scripting.executeScript({target:{tabId:tab.id},func:openEE,args:[cmUrl]})})}function checkSiteSxa(sender,sendResponse){var url=new URL(sender.tab.url);chrome.cookies.getAll({},(function(cookies){for(var i in cookies)if(cookies[i].domain==url.hostname&&"sxa_site"==cookies[i].name&&"login"!=cookies[i].value){sendResponse({farewell:cookies[i].value.toLowerCase()});break}sendResponse({farewell:null})}))}function getSitecoreCookie(tab){chrome.cookies.get({url:tab.url,name:"sitecore_userticket"},(function(cookie){if(cookie.value)return cookie.value}))}function showContextMenu(tab){if(null!=tab.url){var url=tab.url.split("?"),isSitecore=(url=url[0]).includes("/sitecore/"),isUrl=url.includes("http"),isEditMode=tab.url.includes("sc_mode=edit"),isViewSource=url.includes("view-source:");chrome.contextMenus.removeAll((function(){!isUrl||isViewSource||isSitecore||isEditMode||chrome.contextMenus.create({title:"Edit in Experience Editor",contexts:["page"],id:"SitecoreAuthorToolbox"},()=>chrome.runtime.lastError)}))}}function setExtensionIcon(tab){var tabUrl=!1;tab.url&&(tabUrl=new URL(tab.url));var url=tab.url.split("?"),isSitecore=(url=url[0]).includes("/sitecore/"),isUrl=url.includes("http"),isLocalhost=url.includes("localhost"),isViewSource=url.includes("view-source:"),cookie=!1;isUrl&&!isViewSource&&tabUrl?chrome.cookies.getAll({url:tabUrl.origin},(function(cookies){for(var i in chrome.action.setBadgeBackgroundColor({color:"#52cc7f"}),cookies)if("sitecore_userticket"==cookies[i].name||"sc_horizon"==cookies[i].name||cookies[i].name.includes("#lang")||cookies[i].name.includes("#sc_mode")){cookie=!0;break}cookie?(chrome.action.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.action.setBadgeText({text:"ON"}),chrome.storage.sync.get(["feature_contextmenu"],result=>{null==result.feature_contextmenu&&(result.feature_contextmenu=!1),result.feature_contextmenu&&showContextMenu(tab)})):(chrome.action.setBadgeBackgroundColor({color:"#777777"}),chrome.action.setBadgeText({text:"OFF"}))})):isSitecore&&(chrome.action.setBadgeBackgroundColor({color:"#52cc7f"}),chrome.action.setBadgeText({text:"ON"}))}chrome.contextMenus.onClicked.addListener(onRightClickHandler),chrome.runtime.onMessage.addListener((function(request,sender,sendResponse){return"get_pagestatus"==request.greeting&&fetch(request.url,{redirect:"follow"}).then((function(response){sendResponse({status:response.status,redirected:response.redirected})})).catch((function(error){sendResponse({error:error})})),"sxa_site"==request.greeting&&checkSiteSxa(sender,sendResponse),!0})),chrome.tabs.onActivated.addListener(async()=>{let tab;setExtensionIcon(await getCurrentTab())}),chrome.runtime.setUninstallURL("https://uquaisse.io/sitecore-cms/uninstallation-successful/?utm_source=uninstall&utm_medium=chrome"),chrome.runtime.onInstalled.addListener((function(details){let thisVersion=chrome.runtime.getManifest().version;"install"==details.reason||"update"==details.reason&&(thisVersion!=details.previousVersion?console.log(`Updated from ${details.previousVersion} to ${thisVersion}`):console.log("Extension reloaded"))}));